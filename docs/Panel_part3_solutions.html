<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tobias Rüttenauer">

<title>Panel Data Analysis - Solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Panel Data Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Panel_part1.html" rel="" target="">
 <span class="menu-text">1) Panel data methods</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Panel_part2.html" rel="" target="">
 <span class="menu-text">2) Advanced Methods</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Panel_part3.html" rel="" target="">
 <span class="menu-text">3) Exercises</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://ruettenauer.github.io/Panel-Data-Analysis/">
            Source Code
            </a>
          </li>
      </ul>
    </div>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#required-packages" id="toc-required-packages" class="nav-link active" data-scroll-target="#required-packages">Required packages</a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise 1</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise 2</a>
  <ul class="collapse">
  <li><a href="#pooled-ols" id="toc-pooled-ols" class="nav-link" data-scroll-target="#pooled-ols">Pooled OLS</a></li>
  <li><a href="#between-model" id="toc-between-model" class="nav-link" data-scroll-target="#between-model">Between model</a></li>
  <li><a href="#fixed-effects-model" id="toc-fixed-effects-model" class="nav-link" data-scroll-target="#fixed-effects-model">Fixed Effects model</a></li>
  <li><a href="#random-effects-model" id="toc-random-effects-model" class="nav-link" data-scroll-target="#random-effects-model">Random Effects model</a></li>
  <li><a href="#cre-random-effects-model" id="toc-cre-random-effects-model" class="nav-link" data-scroll-target="#cre-random-effects-model">CRE Random Effects model</a></li>
  </ul></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise 3</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise 4</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Solutions</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://ruettenauer.github.io/">Tobias Rüttenauer</a> <a href="https://orcid.org/0000-0001-5747-9735" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            UCL Social Research Institute
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  

</header>

<section id="required-packages" class="level3">
<h3 class="anchored" data-anchor-id="required-packages">Required packages</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"plm"</span>, <span class="st">"feisr"</span>, <span class="st">"sandwich"</span>, <span class="st">"did"</span>, <span class="st">"texreg"</span>, <span class="st">"tidyr"</span>, <span class="st">"haven"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"ggforce"</span>) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(pkgs, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="session-info" class="level3">
<h3 class="anchored" data-anchor-id="session-info">Session info</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19044)

Matrix products: default


locale:
[1] LC_COLLATE=English_United Kingdom.utf8 
[2] LC_CTYPE=English_United Kingdom.utf8   
[3] LC_MONETARY=English_United Kingdom.utf8
[4] LC_NUMERIC=C                           
[5] LC_TIME=English_United Kingdom.utf8    

time zone: Europe/London
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ggforce_0.4.1  ggplot2_3.4.2  dplyr_1.1.2    haven_2.5.3    tidyr_1.3.0   
 [6] texreg_1.38.6  did_2.1.2      sandwich_3.0-2 feisr_1.3.0    plm_2.6-3     

loaded via a namespace (and not attached):
 [1] gtable_0.3.3        xfun_0.39           htmlwidgets_1.6.2  
 [4] rstatix_0.7.2       collapse_1.9.6      lattice_0.21-8     
 [7] numDeriv_2016.8-1.1 vctrs_0.6.3         tools_4.3.1        
[10] Rdpack_2.4          generics_0.1.3      parallel_4.3.1     
[13] tibble_3.2.1        fansi_1.0.4         pkgconfig_2.0.3    
[16] Matrix_1.5-4.1      data.table_1.14.8   lifecycle_1.0.3    
[19] farver_2.1.1        compiler_4.3.1      maxLik_1.5-2       
[22] munsell_0.5.0       carData_3.0-5       htmltools_0.5.5    
[25] yaml_2.3.7          Formula_1.2-5       pillar_1.9.0       
[28] car_3.1-2           ggpubr_0.6.0        MASS_7.3-60        
[31] abind_1.4-5         nlme_3.1-162        tidyselect_1.2.0   
[34] bdsmatrix_1.3-6     digest_0.6.32       purrr_1.0.1        
[37] forcats_1.0.0       miscTools_0.6-28    polyclip_1.10-4    
[40] fastmap_1.1.1       grid_4.3.1          colorspace_2.1-0   
[43] cli_3.6.1           lfe_2.9-0           magrittr_2.0.3     
[46] utf8_1.2.3          broom_1.0.5         withr_2.5.0        
[49] dreamerr_1.2.3      scales_1.2.1        backports_1.4.1    
[52] httr_1.4.6          rmarkdown_2.23      ggsignif_0.6.4     
[55] hms_1.1.3           zoo_1.8-12          evaluate_0.21      
[58] knitr_1.43          rbibutils_2.2.13    lmtest_0.9-40      
[61] fixest_0.11.1       rlang_1.1.1         Rcpp_1.0.10        
[64] xtable_1.8-4        glue_1.6.2          tweenr_2.0.2       
[67] BMisc_1.4.5         rstudioapi_0.14     jsonlite_1.8.5     
[70] R6_2.5.1           </code></pre>
</div>
</div>
</section>
<section id="load-data" class="level3">
<h3 class="anchored" data-anchor-id="load-data">Load data</h3>
<p>For the purpose of this exercise, we will use a real-world data set. However, instead of constructing our own data, we use a shortcut and use data from the replication package of <span class="citation" data-cites="Hospido.2012">Hospido (<a href="#ref-Hospido.2012" role="doc-biblioref">2012</a>)</span>. The replication package can be found <a href="http://qed.econ.queensu.ca/jae/datasets/hospido001/">here</a>.</p>
<p>THis is an unbalanced panel with 32,066 observations and 2066 individuals for the period 1968–1993 of the PSID. It consists of male heads aged 25–55 with at least 9 years of usable wages data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load stata file</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"_data/h-data.dta"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets order this</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(data.df)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>, names[<span class="sc">-</span><span class="fu">which</span>(names <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>))])</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[, names]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th>variable name</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pid</td>
<td>INDIVIDUAL IDENTIFIER</td>
</tr>
<tr class="even">
<td>year</td>
<td>YEAR OF INTERVIEW</td>
</tr>
<tr class="odd">
<td>age</td>
<td>AGE OF INDIVIDUAL</td>
</tr>
<tr class="even">
<td>white</td>
<td>WHITE DUMMY</td>
</tr>
<tr class="odd">
<td>dropout</td>
<td>DROPOUT DUMMY</td>
</tr>
<tr class="even">
<td>grad</td>
<td>GRADUATE DUMMY</td>
</tr>
<tr class="odd">
<td>college</td>
<td>COLLEGE DUMMY</td>
</tr>
<tr class="even">
<td>married</td>
<td>MARRIED DUMMY</td>
</tr>
<tr class="odd">
<td>child</td>
<td>NUMBER OF CHILDREN</td>
</tr>
<tr class="even">
<td>fsize</td>
<td>FAMILY SIZE</td>
</tr>
<tr class="odd">
<td>hours</td>
<td>YEARLY HOURS OF WORK</td>
</tr>
<tr class="even">
<td>logwages</td>
<td>LOG OF REAL ANNUAL WAGES</td>
</tr>
<tr class="odd">
<td>changejob</td>
<td>JOB CHANGE DUMMY</td>
</tr>
<tr class="even">
<td>ten1</td>
<td>TENURE DUMMY less than a year</td>
</tr>
<tr class="odd">
<td>ten2</td>
<td>TENURE DUMMY a year</td>
</tr>
<tr class="even">
<td>ten3</td>
<td>TENURE DUMMY 2-3 years</td>
</tr>
<tr class="odd">
<td>ten4</td>
<td>TENURE DUMMY 4 through 9 years</td>
</tr>
<tr class="even">
<td>ten5</td>
<td>TENURE DUMMY 10 through 19 years</td>
</tr>
<tr class="odd">
<td>ten6</td>
<td>TENURE DUMMY 20 years or more</td>
</tr>
<tr class="even">
<td>profes</td>
<td>PROFESSIONAL, TECHNICAL, AND KINDRED WORKERS DUMMY</td>
</tr>
<tr class="odd">
<td>admin</td>
<td>MANAGERS AND ADMINISTRATORS DUMMY</td>
</tr>
<tr class="even">
<td>sales</td>
<td>CLERICAL AND SALES WORKERS DUMMY</td>
</tr>
<tr class="odd">
<td>crafts</td>
<td>CRAFTSMAN AND KINDRED WORKERS DUMMY</td>
</tr>
<tr class="even">
<td>operat</td>
<td>OPERATIVES WORKERS DUMMY</td>
</tr>
<tr class="odd">
<td>servic</td>
<td>LABORERS AND SERVICES WORKERS DUMMY</td>
</tr>
<tr class="even">
<td>smsa</td>
<td>SMSA (Standard Metropolitan Statistical Area) DUMMY</td>
</tr>
<tr class="odd">
<td>neast</td>
<td>NORTH-EAST DUMMY</td>
</tr>
<tr class="even">
<td>ncentr</td>
<td>NORTH-CENTRAL DUMMY</td>
</tr>
<tr class="odd">
<td>south</td>
<td>SOUTH DUMMY</td>
</tr>
<tr class="even">
<td>west</td>
<td>WEST DUMMY</td>
</tr>
</tbody>
</table>
</section>
<section id="exercise-1" class="level1">
<h1>Exercise 1</h1>
<p>Have a look at the data.</p>
<ul>
<li>How many observations do we have in 1968? How many in 1990?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
1968 1969 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 
 655  694  738  780  856  943 1018 1098 1178 1229 1263 1310 1380 1419 1464 1506 
1984 1985 1986 1987 1988 1989 1990 1991 1992 1993 
1559 1626 1583 1536 1486 1434 1392 1348 1315 1256 </code></pre>
</div>
</div>
<ul>
<li>What is the average age in 1968? What was it in 1984? And how is this possible?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(data.df<span class="sc">$</span>age, data.df<span class="sc">$</span>year, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">summary</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>data.df$year: 1968
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   31.50   38.00   36.99   42.00   50.00 
------------------------------------------------------------ 
data.df$year: 1969
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   25.0    31.0    38.0    37.4    43.0    52.0 
------------------------------------------------------------ 
data.df$year: 1970
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   31.00   38.00   37.56   44.00   51.00 
------------------------------------------------------------ 
data.df$year: 1971
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   31.00   39.00   37.99   44.00   52.00 
------------------------------------------------------------ 
data.df$year: 1972
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   30.00   39.00   37.95   45.00   52.00 
------------------------------------------------------------ 
data.df$year: 1973
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   30.00   38.00   37.83   45.50   53.00 
------------------------------------------------------------ 
data.df$year: 1974
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   25.0    29.0    38.0    37.9    46.0    54.0 
------------------------------------------------------------ 
data.df$year: 1975
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   29.00   37.00   37.98   47.00   55.00 
------------------------------------------------------------ 
data.df$year: 1976
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   25.0    29.0    37.0    38.1    47.0    55.0 
------------------------------------------------------------ 
data.df$year: 1977
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   29.00   36.00   37.78   47.00   55.00 
------------------------------------------------------------ 
data.df$year: 1978
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   29.00   35.00   37.27   46.00   55.00 
------------------------------------------------------------ 
data.df$year: 1979
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   29.00   34.00   36.90   45.75   55.00 
------------------------------------------------------------ 
data.df$year: 1980
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   29.00   33.00   36.61   44.00   55.00 
------------------------------------------------------------ 
data.df$year: 1981
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   29.00   34.00   36.31   43.00   55.00 
------------------------------------------------------------ 
data.df$year: 1982
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   29.00   34.00   36.23   42.00   55.00 
------------------------------------------------------------ 
data.df$year: 1983
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   29.00   34.00   36.07   41.00   55.00 
------------------------------------------------------------ 
data.df$year: 1984
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   29.00   34.00   35.83   40.00   55.00 
------------------------------------------------------------ 
data.df$year: 1985
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   29.25   34.00   35.77   40.00   55.00 
------------------------------------------------------------ 
data.df$year: 1986
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  25.00   30.00   35.00   36.34   41.00   55.00 
------------------------------------------------------------ 
data.df$year: 1987
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  26.00   31.00   35.00   37.02   41.00   55.00 
------------------------------------------------------------ 
data.df$year: 1988
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  27.00   32.00   36.00   37.61   42.00   55.00 
------------------------------------------------------------ 
data.df$year: 1989
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  28.00   33.00   37.00   38.25   42.00   55.00 
------------------------------------------------------------ 
data.df$year: 1990
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  29.00   34.00   38.00   38.92   43.00   55.00 
------------------------------------------------------------ 
data.df$year: 1991
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  30.00   35.00   39.00   39.71   44.00   55.00 
------------------------------------------------------------ 
data.df$year: 1992
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  31.00   36.00   39.00   40.48   44.00   55.00 
------------------------------------------------------------ 
data.df$year: 1993
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  32.00   37.00   41.00   41.45   45.00   55.00 </code></pre>
</div>
</div>
<ul>
<li>At which age did individual with ID “5790002” become father?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data.df[data.df<span class="sc">$</span>pid <span class="sc">==</span> <span class="dv">5790002</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 30
       pid  year   age fsize hours child  ten1  ten2  ten3  ten4  ten5  ten6
     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 5790002  1969    31     2  2352     0     0     0     1     0     0     0
 2 5790002  1970    32     2  1960     0     0     0     1     0     0     0
 3 5790002  1971    33     2  2040     0     0     0     0     1     0     0
 4 5790002  1972    34     2  1880     0     0     0     0     1     0     0
 5 5790002  1973    35     3  1578     1     1     0     0     0     0     0
 6 5790002  1974    37     3  2400     1     0     1     0     0     0     0
 7 5790002  1975    37     3   890     1     0     0     1     0     0     0
 8 5790002  1976    37     3  1060     1     0     1     0     0     0     0
 9 5790002  1977    38     3  2041     1     0     0     1     0     0     0
10 5790002  1978    40     3  1820     1     0     0     1     0     0     0
# ℹ 15 more rows
# ℹ 18 more variables: changejob &lt;dbl&gt;, logwages &lt;dbl&gt;, white &lt;dbl&gt;,
#   smsa &lt;dbl&gt;, dropout &lt;dbl&gt;, grad &lt;dbl&gt;, college &lt;dbl&gt;, neast &lt;dbl&gt;,
#   ncentr &lt;dbl&gt;, south &lt;dbl&gt;, west &lt;dbl&gt;, married &lt;dbl&gt;, profes &lt;dbl&gt;,
#   admin &lt;dbl&gt;, sales &lt;dbl&gt;, crafts &lt;dbl&gt;, operat &lt;dbl&gt;, servic &lt;dbl&gt;</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View(data.df[data.df$pid == 5790002, ])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Please calculate the average age for each person.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ave by id</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>m_age <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>age,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> data.df<span class="sc">$</span>pid,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>data.df[,<span class="fu">c</span> (<span class="st">"pid"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"m_age"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32,066 × 4
     pid  year   age m_age
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  4175  1985    25    29
 2  4175  1986    26    29
 3  4175  1987    27    29
 4  4175  1988    28    29
 5  4175  1989    29    29
 6  4175  1990    30    29
 7  4175  1991    31    29
 8  4175  1992    32    29
 9  4175  1993    33    29
10 11003  1979    26    33
# ℹ 32,056 more rows</code></pre>
</div>
</div>
<ul>
<li>Please calculate the lagged age (the age in the previous period)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure the data is ordered by id and year</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use dplyr::lag to calculate the age in the previous period</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Put into ave by id to make sure to use only information within each id</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>lag_age <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>age,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> data.df<span class="sc">$</span>pid,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">FUN =</span> <span class="cf">function</span>(x) dplyr<span class="sc">::</span><span class="fu">lag</span>(x, <span class="at">n =</span> <span class="dv">1</span>)) <span class="co"># 1 year lag</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>data.df[,<span class="fu">c</span> (<span class="st">"pid"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"m_age"</span>, <span class="st">"lag_age"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32,066 × 5
     pid  year   age m_age lag_age
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
 1  4175  1985    25    29      NA
 2  4175  1986    26    29      25
 3  4175  1987    27    29      26
 4  4175  1988    28    29      27
 5  4175  1989    29    29      28
 6  4175  1990    30    29      29
 7  4175  1991    31    29      30
 8  4175  1992    32    29      31
 9  4175  1993    33    29      32
10 11003  1979    26    33      NA
# ℹ 32,056 more rows</code></pre>
</div>
</div>
</section>
<section id="exercise-2" class="level1">
<h1>Exercise 2</h1>
<p>Just to play a little bit around with the data, let us estimate some models.</p>
<ul>
<li>What is the correlation between age and wage? Please use different estimators to determine different tzpes of correlations.</li>
</ul>
<section id="pooled-ols" class="level3">
<h3 class="anchored" data-anchor-id="pooled-ols">Pooled OLS</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mod1.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(logwages <span class="sc">~</span> age, <span class="at">data =</span> data.df)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = logwages ~ age, data = data.df)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.7705 -0.2812  0.0759  0.3672  2.3104 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 9.8320553  0.0152740   643.7   &lt;2e-16 ***
age         0.0118445  0.0003974    29.8   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5814 on 32064 degrees of freedom
Multiple R-squared:  0.02696,   Adjusted R-squared:  0.02693 
F-statistic: 888.3 on 1 and 32064 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The higher the age of an observation, the higher their wage. If the age of an observation is 1 year higher, the log annual wage of this observation is 0.0118. In other words, the wage of an observation is higher by 1.19% with an additional year of age (the mean annual wage is 33672).</p>
</section>
<section id="between-model" class="level3">
<h3 class="anchored" data-anchor-id="between-model">Between model</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mod1.btw <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> age, </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>), <span class="co"># id and time</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">effect =</span> <span class="st">"individual"</span>, <span class="co"># individual, time, or twoways as FE? </span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">model =</span> <span class="st">"between"</span>,     <span class="co"># between, FE, RE, FD</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> data.df)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.btw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Between Model

Call:
plm(formula = logwages ~ age, data = data.df, effect = "individual", 
    model = "between", id = c("pid", "year"))

Unbalanced Panel: n = 2066, T = 9-26, N = 32066
Observations used in estimation: 2066

Residuals:
     Min.   1st Qu.    Median   3rd Qu.      Max. 
-2.804339 -0.279375  0.055394  0.327354  1.415169 

Coefficients:
             Estimate Std. Error  t-value  Pr(&gt;|t|)    
(Intercept) 9.9989475  0.0592097 168.8733 &lt; 2.2e-16 ***
age         0.0068539  0.0015675   4.3725  1.29e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    498.39
Residual Sum of Squares: 493.81
R-Squared:      0.0091778
Adj. R-Squared: 0.0086977
F-statistic: 19.1184 on 1 and 2064 DF, p-value: 1.2896e-05</code></pre>
</div>
</div>
<p>The higher the age of an individual, the higher their wage. If the age of an individual is 1 year higher, the log annual wage of this individual is 0.0069. In other words, the wage of an individual is higher by 0.69% with an additional year of age (the mean annual wage is 33672).</p>
</section>
<section id="fixed-effects-model" class="level3">
<h3 class="anchored" data-anchor-id="fixed-effects-model">Fixed Effects model</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mod1.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> age, </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>), <span class="co"># id and time</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">effect =</span> <span class="st">"individual"</span>, <span class="co"># individual, time, or twoways as FE? </span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">model =</span> <span class="st">"within"</span>,     <span class="co"># between, FE, RE, FD</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> data.df)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.fe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Within Model

Call:
plm(formula = logwages ~ age, data = data.df, effect = "individual", 
    model = "within", id = c("pid", "year"))

Unbalanced Panel: n = 2066, T = 9-26, N = 32066

Residuals:
     Min.   1st Qu.    Median   3rd Qu.      Max. 
-3.735420 -0.103058  0.023293  0.151912  2.380972 

Coefficients:
     Estimate Std. Error t-value  Pr(&gt;|t|)    
age 0.0197047  0.0003639  54.149 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    3718.1
Residual Sum of Squares: 3387
R-Squared:      0.089038
Adj. R-Squared: 0.026301
F-statistic: 2932.11 on 1 and 29999 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster robust standard errors</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>vcovx <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(mod1.fe, <span class="at">cluster =</span> <span class="st">"group"</span>, <span class="at">method =</span> <span class="st">"arellano"</span>, <span class="at">type =</span> <span class="st">"HC3"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>mod1.fe<span class="sc">$</span>vcov <span class="ot">&lt;-</span> vcovx</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.fe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Within Model

Call:
plm(formula = logwages ~ age, data = data.df, effect = "individual", 
    model = "within", id = c("pid", "year"))

Unbalanced Panel: n = 2066, T = 9-26, N = 32066

Residuals:
     Min.   1st Qu.    Median   3rd Qu.      Max. 
-3.735420 -0.103058  0.023293  0.151912  2.380972 

Coefficients:
      Estimate Std. Error t-value  Pr(&gt;|t|)    
age 0.01970472 0.00078957  24.956 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    3718.1
Residual Sum of Squares: 3387
R-Squared:      0.089038
Adj. R-Squared: 0.026301
F-statistic: 622.818 on 1 and 29999 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<p>The higher the age of an individual, the higher their wage. If an individual become one year older, the log annual wage of this individual increases by 0.0197. In other words, the wage of an individual increases by 1.99% with an additional year of age for this individual (the mean annual wage is 33672).</p>
</section>
<section id="random-effects-model" class="level3">
<h3 class="anchored" data-anchor-id="random-effects-model">Random Effects model</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mod1.re <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> age, </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>), <span class="co"># id and time</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">effect =</span> <span class="st">"individual"</span>, <span class="co"># individual, time, or twoways as FE? </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">model =</span> <span class="st">"random"</span>,     <span class="co"># between, FE, RE, FD</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> data.df)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.re)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Random Effect Model 
   (Swamy-Arora's transformation)

Call:
plm(formula = logwages ~ age, data = data.df, effect = "individual", 
    model = "random", id = c("pid", "year"))

Unbalanced Panel: n = 2066, T = 9-26, N = 32066

Effects:
                 var std.dev share
idiosyncratic 0.1129  0.3360 0.337
individual    0.2226  0.4718 0.663
theta:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.7690  0.8062  0.8298  0.8245  0.8464  0.8617 

Residuals:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-3.8127 -0.1039  0.0374  0.0013  0.1713  2.3549 

Coefficients:
              Estimate Std. Error z-value  Pr(&gt;|z|)    
(Intercept) 9.54734049 0.01691335 564.485 &lt; 2.2e-16 ***
age         0.01902706 0.00035495  53.605 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    6229.4
Residual Sum of Squares: 3635.9
R-Squared:      0.41669
Adj. R-Squared: 0.41667
Chisq: 2873.53 on 1 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<p>The higher the age of an individual, the higher their wage. Well,… I don’t actually know how to translate that into a substantive interpretation.</p>
</section>
<section id="cre-random-effects-model" class="level3">
<h3 class="anchored" data-anchor-id="cre-random-effects-model">CRE Random Effects model</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate group-specific means of ALL X variables</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>m_age <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>age,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> data.df<span class="sc">$</span>pid,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate in RE model</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>mod1.cre <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> age <span class="sc">+</span> m_age, </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>), <span class="co"># id and time</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">effect =</span> <span class="st">"individual"</span>, <span class="co"># individual, time, or twoways as FE? </span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">model =</span> <span class="st">"random"</span>,     <span class="co"># between, FE, RE, FD</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">random.method =</span> <span class="st">"walhus"</span>, <span class="co"># to avoid singularities</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> data.df)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.cre)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Oneway (individual) effect Random Effect Model 
   (Wallace-Hussain's transformation)

Call:
plm(formula = logwages ~ age + m_age, data = data.df, effect = "individual", 
    model = "random", random.method = "walhus", id = c("pid", 
        "year"))

Unbalanced Panel: n = 2066, T = 9-26, N = 32066

Effects:
                 var std.dev share
idiosyncratic 0.1129  0.3360 0.337
individual    0.2226  0.4718 0.663
theta:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.7690  0.8062  0.8298  0.8245  0.8464  0.8617 

Residuals:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-3.8179 -0.1032  0.0399  0.0018  0.1712  2.3527 

Coefficients:
               Estimate  Std. Error z-value  Pr(&gt;|z|)    
(Intercept)  9.99990200  0.05835736 171.356 &lt; 2.2e-16 ***
age          0.01970472  0.00036432  54.086 &lt; 2.2e-16 ***
m_age       -0.01285703  0.00158689  -8.102 5.405e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Total Sum of Squares:    6229.4
Residual Sum of Squares: 3628.5
R-Squared:      0.41813
Adj. R-Squared: 0.4181
Chisq: 2944.97 on 2 DF, p-value: &lt; 2.22e-16</code></pre>
</div>
</div>
<ol type="1">
<li><p>If an individual become one year older, the log annual wage of this individual increases by 0.0197. In other words, the wage of an individual increases by 1.99% with an additional year of age for this individual.</p></li>
<li><p>If the age of an individual is 1 year higher, the log annual wage of this individual is 0.0068 (-0.0129 + 0.0197). In other words, the wage of an individual is higher by 0.69% with an additional year of age</p></li>
</ol>
</section>
</section>
<section id="exercise-3" class="level1">
<h1>Exercise 3</h1>
<p>Can we use this dataset to replicate our earlier analysis on the marital wage premium? What might be a problem here? (tip: have a look a the marriage variable).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Lets check if variable are time-varying or constant</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(data.df, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">ave</span>(x, data.df<span class="sc">$</span>pid, <span class="at">FUN =</span> sd)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$pid
[1] 0

$year
[1] 5.084193

$age
[1] 5.091139

$fsize
[1] 0.8707511

$hours
[1] 371.2656

$child
[1] 0.8319735

$ten1
[1] 0.2655135

$ten2
[1] 0.2251966

$ten3
[1] 0.3190326

$ten4
[1] 0.4291132

$ten5
[1] 0.3305668

$ten6
[1] 0.1446421

$changejob
[1] 0.293274

$logwages
[1] 0.2923183

$white
[1] 0.01130643

$smsa
[1] 0.1294999

$dropout
[1] 0.03838475

$grad
[1] 0.06823993

$college
[1] 0.03114909

$neast
[1] 0.01985548

$ncentr
[1] 0.02750533

$south
[1] 0.03582719

$west
[1] 0.02641131

$married
[1] 0

$profes
[1] 0.1099356

$admin
[1] 0.1295905

$sales
[1] 0.09946584

$crafts
[1] 0.1912406

$operat
[1] 0.1720871

$servic
[1] 0.1322412

$m_age
[1] 0

$lag_age
[1] NA</code></pre>
</div>
</div>
<p>The variable married is time-constant and does not have any within-person variance. This is somehow not very useful, as marital status obviously is not a time-constant trait.</p>
<p>However, we do something similar: is there a fatherhood wage premium? In other words, do men experience an increase in wages when they become fathers?</p>
<pre><code>* Restrict the age at the start (first wage) to people aged 25-35</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ] <span class="co"># just to be sure</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Person year number</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>pynr <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>year,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                data.df<span class="sc">$</span>pid,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x))</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Age at first wave</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_age <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>pynr <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>age, <span class="cn">NA</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute across individual, using mean and na.rm = TRUE</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_age <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>f_age,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>                     data.df<span class="sc">$</span>pid,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   25    26    27    28    29    30    31    32    33    34    35    36    37 
14803  2973  1417  1091  1155   813   743   496   715   888   678   564   653 
   38    39    40    41    42    43    44    45    46    47    48    49    50 
  618   673   709   553   549   419   398   402   365   296    47    28    20 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>f_age <span class="sc">&lt;=</span> <span class="dv">35</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<pre><code>* Use number of children to construct a binary indicator of wether the is a child in the household or not</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>child_hh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>child <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>child, data.df<span class="sc">$</span>child_hh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    
        0    1
  0  7651    0
  1     0 5428
  2     0 7397
  3     0 3525
  4     0 1207
  5     0  328
  6     0  158
  7     0   42
  8     0   15
  9     0   12
  10    0    8
  11    0    1</code></pre>
</div>
</div>
<pre><code>* Make sure we start only with men who are not yet fathers.</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Child status at first wave</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_child_hh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>pynr <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>child_hh, <span class="cn">NA</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_child_hh) <span class="co"># More than 1,500 individuals are already child_hh from the start on</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
748 859 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute across individual, using mean and na.rm = TRUE</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>f_child_hh,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                         data.df<span class="sc">$</span>pid,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_child_hh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    0     1 
11424 14348 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop those who are child_hh from the start</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>f_child_hh <span class="sc">==</span> <span class="dv">0</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Note: this feels like dropping a lot of information! However, it makes sense if we want to correctly identify the effect of interest.</strong></p>
<pre><code>* Do we need to drop observations where people go from child to no child?</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Change in child status within an id</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>fd_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                          data.df<span class="sc">$</span>pid,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span>(x) x <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(x, <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>)) <span class="co"># 0 instead of NA for 1st year</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>fd_child_hh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   -1     0     1 
  143 10660   621 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are indeed people going from child to "no child"</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It might be that children leave the households, or parents get divorced?</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># One should usually look into this more carefully, but here let's just drop those observations.</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark observations starting with a negative fd value (jump from marry=1 to marry =0)</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>notstag_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(<span class="fu">ifelse</span>(data.df<span class="sc">$</span>fd_child_hh <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                               data.df<span class="sc">$</span>pid,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">cumsum</span>(x))</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>notstag_child_hh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    0     1     2 
10560   821    43 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop after "loosing a child"</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>notstag_child_hh <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>fd_child_hh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   0    1 
9979  581 </code></pre>
</div>
</div>
<pre><code>* Calculate the effect of having a child on the wage of men (including controls if reasonable). 

* Calculate effects for POLS, RE, and FE (if you have some extra time, also FEIS). (#Hint: feis needs a class `data.frame` as input data)</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Age intervals</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>int <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>, <span class="fu">max</span>(data.df<span class="sc">$</span>age), <span class="dv">5</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>age_gr <span class="ot">&lt;-</span> <span class="fu">cut</span>(data.df<span class="sc">$</span>age, int, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Formula with controls</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(logwages <span class="sc">~</span> child_hh <span class="sc">+</span> </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="do">### POLS</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>mod.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(fm, <span class="at">data =</span> data.df)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="do">### RE</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>mod.re <span class="ot">&lt;-</span> <span class="fu">plm</span>(fm, <span class="at">data =</span> data.df,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"random"</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="do">### FE</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>mod.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(fm, <span class="at">data =</span> data.df,</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a><span class="do">### FEIS</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="co"># GIven that we have a relatively large T, we can actually use the 5 tenure dummies here</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>mod.feis <span class="ot">&lt;-</span> <span class="fu">feis</span>(logwages <span class="sc">~</span> child_hh <span class="sc">+</span> </span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>                   smsa <span class="sc">+</span> </span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.factor</span>(year) <span class="sc">|</span> ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, <span class="co"># Note we add year manually here</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">data.frame</span>(data.df),</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>), <span class="at">robust =</span> <span class="cn">TRUE</span>) <span class="co"># we use the cluster-robust SEs right away</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in feis(logwages ~ child_hh + hours + age_gr + profes + admin + : FEIS needs at least n(slopes)+1 observations per group. 
 You specified 6 slope parameter(s) plus intercept, all groups with t &lt;= 7 dropped</code></pre>
</div>
</div>
<pre><code>* Compare using cluster robust standard errors (and screenreg).</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Cluster robust SEs for RE and FE</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>vcov.re <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(mod.re, <span class="at">cluster =</span> <span class="st">"group"</span>, <span class="at">method =</span> <span class="st">"arellano"</span>, <span class="at">type =</span> <span class="st">"HC3"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>vcov.fe <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(mod.fe, <span class="at">cluster =</span> <span class="st">"group"</span>, <span class="at">method =</span> <span class="st">"arellano"</span>, <span class="at">type =</span> <span class="st">"HC3"</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plug into model object</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>mod.re<span class="sc">$</span>vcov <span class="ot">&lt;-</span> vcov.re</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>mod.fe<span class="sc">$</span>vcov <span class="ot">&lt;-</span> vcov.fe</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="do">### Compare</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(<span class="fu">list</span>(mod.lm, mod.re, mod.fe, mod.feis), <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">custom.model.names =</span> <span class="fu">c</span>(<span class="st">"POLS"</span>, <span class="st">"RE"</span>, <span class="st">"FE"</span>, <span class="st">"FEIS"</span>), </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.groups =</span> <span class="cn">FALSE</span>, <span class="co"># don't know why include.groups = FALSE is necessary here</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.coef =</span> <span class="st">"year"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=========================================================================
               POLS           RE             FE             FEIS         
-------------------------------------------------------------------------
(Intercept)        8.747 ***      8.976 ***                              
                  (0.051)        (0.106)                                 
child_hh           0.137 ***      0.101 ***      0.040 *        0.055 ** 
                  (0.010)        (0.029)        (0.016)        (0.019)   
hours              0.000 ***      0.000 ***      0.000 ***      0.000 ***
                  (0.000)        (0.000)        (0.000)        (0.000)   
age_gr(30,35]      0.110 ***      0.143 ***      0.008          0.027    
                  (0.012)        (0.019)        (0.013)        (0.015)   
age_gr(35,40]      0.201 ***      0.233 ***     -0.036         -0.023    
                  (0.014)        (0.030)        (0.022)        (0.022)   
age_gr(40,45]      0.239 ***      0.282 ***     -0.131 ***     -0.106 ***
                  (0.019)        (0.042)        (0.031)        (0.032)   
age_gr(45,50]      0.251 ***      0.313 ***     -0.236 ***     -0.208 ***
                  (0.029)        (0.060)        (0.043)        (0.046)   
age_gr(50,55]      0.173 ***      0.264 *       -0.426 ***     -0.444 ***
                  (0.053)        (0.107)        (0.084)        (0.094)   
profes             0.249 ***      0.179 *        0.121 **       0.133 ** 
                  (0.045)        (0.074)        (0.045)        (0.045)   
admin              0.250 ***      0.160 *        0.104 *        0.128 ** 
                  (0.046)        (0.076)        (0.045)        (0.046)   
sales             -0.004          0.057          0.041          0.084    
                  (0.046)        (0.075)        (0.046)        (0.048)   
crafts            -0.031          0.057          0.060          0.091 *  
                  (0.045)        (0.071)        (0.042)        (0.044)   
operat            -0.178 ***      0.032          0.068          0.098 *  
                  (0.046)        (0.076)        (0.045)        (0.047)   
servic            -0.371 ***     -0.028          0.021          0.057    
                  (0.046)        (0.087)        (0.047)        (0.048)   
smsa               0.114 ***      0.023          0.018          0.026    
                  (0.010)        (0.029)        (0.020)        (0.021)   
ten1               0.242 ***      0.112 *        0.101 *                 
                  (0.028)        (0.054)        (0.039)                  
ten2               0.382 ***      0.223 ***      0.209 ***               
                  (0.029)        (0.056)        (0.038)                  
ten3               0.404 ***      0.275 ***      0.263 ***               
                  (0.028)        (0.054)        (0.037)                  
ten4               0.471 ***      0.331 ***      0.308 ***               
                  (0.027)        (0.057)        (0.038)                  
ten5               0.509 ***      0.317 ***      0.270 ***               
                  (0.028)        (0.064)        (0.037)                  
ten6               0.536 ***      0.290 **       0.220 ***               
                  (0.037)        (0.092)        (0.043)                  
-------------------------------------------------------------------------
R^2                0.426          0.374          0.287          0.273    
Adj. R^2           0.425          0.373          0.230          0.270    
Num. obs.      10560          10560          10560          10336        
s_idios                           0.299                                  
s_id                              0.332                                  
s_time                            0.016                                  
RMSE                                                            0.313    
=========================================================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<ul>
<li>Interpret the results</li>
</ul>
<p>We can interpret the results above as follows:</p>
<p>POLS and RE: Observations with at least one child in the household tend to have higher annual wages</p>
<p>FE: If men become fathers, this increases their annual wage by ~ 4%. The effect is significant (would be highly significant without cluster robust SEs).</p>
<p>FEIS: Given the heterogeneous wage trajectories, if men become fathers, this increases their annual wage by ~ 5%.</p>
<p>In this case, FEIS estimates a higher premium than FE. This could indicate that those with steeper wage trajectories actually are less likely to get children or get their children later.</p>
<p>Do you know why FEIS has a lower <span class="math inline">\(N\)</span> than the other models?</p>
<ul>
<li>Try to perform a placebo test: what happens if you use the “lead” of becoming father. Why is this an interesting test?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag </span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>lag_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                            data.df<span class="sc">$</span>pid,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">lag</span>(x, <span class="dv">2</span>)) <span class="co"># lets use two years</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Lead</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>lead_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                             data.df<span class="sc">$</span>pid,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">lead</span>(x, <span class="dv">2</span>)) <span class="co"># lets use two years</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="do">### Estimate FE models</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>lag.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> lag_child_hh <span class="sc">+</span> </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, </span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> data.df,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>lead.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> lead_child_hh <span class="sc">+</span> </span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> data.df,</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(<span class="fu">list</span>(lag.fe, lead.fe), <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">custom.coef.map =</span> <span class="fu">list</span>(<span class="at">lag_child_hh =</span> <span class="st">"Lag Child"</span>, </span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lead_child_hh =</span> <span class="st">"Lead Child"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
====================================
            Model 1     Model 2     
------------------------------------
Lag Child      0.025 *              
              (0.011)               
Lead Child                 0.070 ***
                          (0.013)   
------------------------------------
R^2            0.248       0.286    
Adj. R^2       0.176       0.218    
Num. obs.   9064        9064        
====================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<p>Interestingly we already see a significant and non-trivial fatherhood effect on the wage two years before the future father actually become fathers.</p>
<p>If we observe a treatment effect for a treatment that has not yet happened, this might indicate either 1) anticipation effects, or 2) that something is actually confounding our treatment (e.g.&nbsp;selection on pre-treatment trends)</p>
<p>What do you think, what might be happening here?</p>
</section>
<section id="exercise-4" class="level1">
<h1>Exercise 4</h1>
<p>Can we use one of the new event-study approaches, such as the Callaway and SantAnna estimator?</p>
<ul>
<li>Preprocess data (treatment group and timing indicator)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment timing = year if child in household</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>child_hh <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>year, <span class="cn">NA</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define those who never have a child</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>tmp <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                   data.df<span class="sc">$</span>pid,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>never_child <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>tmp <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co"># set never treated to zero</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing[data.df<span class="sc">$</span>never_child <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="co"># if married is not NA, used min year per id (removing NAs)</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>oo <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(data.df<span class="sc">$</span>child_hh))</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing[oo] <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>treat_timing[oo],</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>                                data.df<span class="sc">$</span>pid[oo],</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data.df[, <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>, <span class="st">"child_hh"</span>, <span class="st">"never_child"</span>, <span class="st">"treat_timing"</span>)], <span class="at">n =</span> <span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 35 × 5
     pid  year child_hh never_child treat_timing
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
 1 11003  1979        0           1            0
 2 11003  1980        0           1            0
 3 11003  1981        0           1            0
 4 11003  1982        0           1            0
 5 11003  1983        0           1            0
 6 11003  1984        0           1            0
 7 11003  1985        0           1            0
 8 11003  1986        0           1            0
 9 11003  1987        0           1            0
10 11003  1988        0           1            0
# ℹ 25 more rows</code></pre>
</div>
</div>
<ul>
<li>Estimate the model using <code>att_gt</code></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate group-time average treatment effects using att_gt method</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>wages.attgt <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"logwages"</span>,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idname =</span> <span class="st">"pid"</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">gname =</span> <span class="st">"treat_timing"</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xformla =</span> <span class="sc">~</span> hours <span class="sc">+</span> age_gr,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> data.df,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">allow_unbalanced_panel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">est_method =</span> <span class="st">"ipw"</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>                        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the group-time specific estimates</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>wages.dyn <span class="ot">&lt;-</span> <span class="fu">aggte</span>(wages.attgt, <span class="at">type =</span> <span class="st">"dynamic"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">min_e =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">max_e =</span> <span class="dv">6</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wages.dyn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
aggte(MP = wages.attgt, type = "dynamic", min_e = -3, max_e = 6, 
    na.rm = TRUE)

Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  "Difference-in-Differences with Multiple Time Periods." Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. &lt;https://doi.org/10.1016/j.jeconom.2020.12.001&gt;, &lt;https://arxiv.org/abs/1803.09015&gt; 


Overall summary of ATT's based on event-study/dynamic aggregation:  
    ATT    Std. Error     [ 95%  Conf. Int.]  
 0.1035        0.0277     0.0491      0.1579 *


Dynamic Effects:
 Event time Estimate Std. Error [95% Simult.  Conf. Band]  
         -3   0.0589     0.0364       -0.0379      0.1556  
         -2   0.0292     0.0257       -0.0390      0.0973  
         -1  -0.0566     0.0218       -0.1144      0.0012  
          0   0.0424     0.0192       -0.0087      0.0934  
          1   0.0573     0.0241       -0.0066      0.1212  
          2   0.0843     0.0322       -0.0012      0.1698  
          3   0.1103     0.0330        0.0226      0.1980 *
          4   0.1462     0.0369        0.0482      0.2442 *
          5   0.1487     0.0398        0.0428      0.2545 *
          6   0.1353     0.0430        0.0212      0.2494 *
---
Signif. codes: `*' confidence band does not cover 0

Control Group:  Not Yet Treated,  Anticipation Periods:  0
Estimation Method:  Inverse Probability Weighting</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>zp3 <span class="ot">&lt;-</span> <span class="fu">ggdid</span>(wages.dyn) </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>zp3 <span class="ot">&lt;-</span> zp3 <span class="sc">+</span> </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="fu">gray</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>zp3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Panel_part3_solutions_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Interpret the results</li>
</ul>
<p>The event-time results above again tell a little different story. First, hose getting father already have a little higher wage two and three years before they become fathers. Then, there is a negative anticipation effect in the year before birth (why could this be plausible?). After birth of the first child, fathers’ wages increase significantly more then the wages of non-fathers (however, this is not much more than the effect in year -3).</p>
</section>
<section id="references" class="level1">



<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Hospido.2012" class="csl-entry" role="listitem">
Hospido, L. 2012. <span>“Modelling Heterogeneity and Dynamics in the Volatility of Individual Wages.”</span> <em>Journal of Applied Econometrics</em> 27 (3): 386–414. <a href="https://doi.org/10.1002/jae.1204">https://doi.org/10.1002/jae.1204</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb64" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Solutions"</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_depth: 2</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number_sections: true</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Tobias Rüttenauer</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid:  0000-0001-5747-9735</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="co">    email: t.ruttenauer@ucl.ac.uk</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://ruettenauer.github.io/</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: UCL Social Research Institute</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a><span class="co">        address: University College London</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a><span class="co">        city: London WC1H 0AL</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a><span class="fu">### Required packages</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, warning = FALSE, results = 'hide'}</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"plm"</span>, <span class="st">"feisr"</span>, <span class="st">"sandwich"</span>, <span class="st">"did"</span>, <span class="st">"texreg"</span>, <span class="st">"tidyr"</span>, <span class="st">"haven"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"ggforce"</span>) </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(pkgs, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a><span class="fu">### Session info</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load data</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>For the purpose of this exercise, we will use a real-world data set. However, instead of constructing our own data, we use a shortcut and use data from the replication package of @Hospido.2012. The replication package can be found <span class="co">[</span><span class="ot">here</span><span class="co">](http://qed.econ.queensu.ca/jae/datasets/hospido001/)</span>.</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>THis is an unbalanced panel with 32,066 observations and 2066 individuals for the period 1968–1993 of the PSID. It consists of male heads aged 25–55 with at least 9 years of usable wages data.</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Load stata file</span></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"_data/h-data.dta"</span>)</span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets order this</span></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(data.df)</span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>, names[<span class="sc">-</span><span class="fu">which</span>(names <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>))])</span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[, names]</span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>| variable name   |   description|</span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a>|-----------------|-------------------------------------------------------|</span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a>| pid             |   INDIVIDUAL IDENTIFIER|</span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a>| year            |   YEAR OF INTERVIEW|</span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a>| age             |   AGE OF INDIVIDUAL|</span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a>| white           |   WHITE DUMMY|</span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a>| dropout         |   DROPOUT DUMMY|</span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a>| grad            |   GRADUATE DUMMY|</span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>| college         |   COLLEGE DUMMY|</span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a>| married         |   MARRIED DUMMY|</span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a>| child           |   NUMBER OF CHILDREN|</span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a>| fsize           |   FAMILY SIZE|</span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a>| hours           |   YEARLY HOURS OF WORK|</span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a>| logwages        |   LOG OF REAL ANNUAL WAGES|</span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a>| changejob       |   JOB CHANGE DUMMY|</span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a>| ten1            |   TENURE DUMMY less than a year|</span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a>| ten2            |   TENURE DUMMY a year|</span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a>| ten3            |   TENURE DUMMY 2-3 years|</span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a>| ten4            |   TENURE DUMMY 4 through 9 years|</span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a>| ten5            |   TENURE DUMMY 10 through 19 years|</span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a>| ten6            |   TENURE DUMMY 20 years or more|</span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a>| profes          |   PROFESSIONAL, TECHNICAL, AND KINDRED WORKERS DUMMY|</span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a>| admin           |   MANAGERS AND ADMINISTRATORS DUMMY|</span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a>| sales           |   CLERICAL AND SALES WORKERS DUMMY|</span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a>| crafts          |   CRAFTSMAN AND KINDRED WORKERS DUMMY|</span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a>| operat          |   OPERATIVES WORKERS DUMMY|</span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a>| servic          |   LABORERS AND SERVICES WORKERS DUMMY|</span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a>| smsa            |   SMSA (Standard Metropolitan Statistical Area) DUMMY|</span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a>| neast           |   NORTH-EAST DUMMY|</span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a>| ncentr          |   NORTH-CENTRAL DUMMY|</span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a>| south           |   SOUTH DUMMY|</span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a>| west            |   WEST DUMMY|</span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-97"><a href="#cb64-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-98"><a href="#cb64-98" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exercise 1</span></span>
<span id="cb64-99"><a href="#cb64-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-100"><a href="#cb64-100" aria-hidden="true" tabindex="-1"></a>Have a look at the data. </span>
<span id="cb64-101"><a href="#cb64-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-102"><a href="#cb64-102" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>How many observations do we have in 1968? How many in 1990?</span>
<span id="cb64-103"><a href="#cb64-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-106"><a href="#cb64-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-107"><a href="#cb64-107" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>year)</span>
<span id="cb64-108"><a href="#cb64-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-109"><a href="#cb64-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-110"><a href="#cb64-110" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>What is the average age in 1968? What was it in 1984? And how is this possible?</span>
<span id="cb64-111"><a href="#cb64-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-112"><a href="#cb64-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-115"><a href="#cb64-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-116"><a href="#cb64-116" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(data.df<span class="sc">$</span>age, data.df<span class="sc">$</span>year, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">summary</span>(x))</span>
<span id="cb64-117"><a href="#cb64-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-118"><a href="#cb64-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-119"><a href="#cb64-119" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>At which age did individual with ID "5790002" become father?</span>
<span id="cb64-120"><a href="#cb64-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-123"><a href="#cb64-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-124"><a href="#cb64-124" aria-hidden="true" tabindex="-1"></a>data.df[data.df<span class="sc">$</span>pid <span class="sc">==</span> <span class="dv">5790002</span>, ]</span>
<span id="cb64-125"><a href="#cb64-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-126"><a href="#cb64-126" aria-hidden="true" tabindex="-1"></a><span class="co"># View(data.df[data.df$pid == 5790002, ])</span></span>
<span id="cb64-127"><a href="#cb64-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-128"><a href="#cb64-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-129"><a href="#cb64-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-130"><a href="#cb64-130" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Please calculate the average age for each person. </span>
<span id="cb64-131"><a href="#cb64-131" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb64-134"><a href="#cb64-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-135"><a href="#cb64-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Ave by id</span></span>
<span id="cb64-136"><a href="#cb64-136" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>m_age <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>age,</span>
<span id="cb64-137"><a href="#cb64-137" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> data.df<span class="sc">$</span>pid,</span>
<span id="cb64-138"><a href="#cb64-138" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb64-139"><a href="#cb64-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-140"><a href="#cb64-140" aria-hidden="true" tabindex="-1"></a>data.df[,<span class="fu">c</span> (<span class="st">"pid"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"m_age"</span>)]</span>
<span id="cb64-141"><a href="#cb64-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-142"><a href="#cb64-142" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb64-143"><a href="#cb64-143" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Please calculate the lagged age (the age in the previous period)</span>
<span id="cb64-144"><a href="#cb64-144" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb64-147"><a href="#cb64-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-148"><a href="#cb64-148" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure the data is ordered by id and year</span></span>
<span id="cb64-149"><a href="#cb64-149" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb64-150"><a href="#cb64-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-151"><a href="#cb64-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Use dplyr::lag to calculate the age in the previous period</span></span>
<span id="cb64-152"><a href="#cb64-152" aria-hidden="true" tabindex="-1"></a><span class="co"># Put into ave by id to make sure to use only information within each id</span></span>
<span id="cb64-153"><a href="#cb64-153" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>lag_age <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>age,</span>
<span id="cb64-154"><a href="#cb64-154" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> data.df<span class="sc">$</span>pid,</span>
<span id="cb64-155"><a href="#cb64-155" aria-hidden="true" tabindex="-1"></a>                       <span class="at">FUN =</span> <span class="cf">function</span>(x) dplyr<span class="sc">::</span><span class="fu">lag</span>(x, <span class="at">n =</span> <span class="dv">1</span>)) <span class="co"># 1 year lag</span></span>
<span id="cb64-156"><a href="#cb64-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-157"><a href="#cb64-157" aria-hidden="true" tabindex="-1"></a>data.df[,<span class="fu">c</span> (<span class="st">"pid"</span>, <span class="st">"year"</span>, <span class="st">"age"</span>, <span class="st">"m_age"</span>, <span class="st">"lag_age"</span>)]</span>
<span id="cb64-158"><a href="#cb64-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-159"><a href="#cb64-159" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb64-160"><a href="#cb64-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-161"><a href="#cb64-161" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exercise 2</span></span>
<span id="cb64-162"><a href="#cb64-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-163"><a href="#cb64-163" aria-hidden="true" tabindex="-1"></a>Just to play a little bit around with the data, let us estimate some models.</span>
<span id="cb64-164"><a href="#cb64-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-165"><a href="#cb64-165" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>What is the correlation between age and wage? Please use different estimators to determine different tzpes of correlations.</span>
<span id="cb64-166"><a href="#cb64-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-167"><a href="#cb64-167" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pooled OLS</span></span>
<span id="cb64-170"><a href="#cb64-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-171"><a href="#cb64-171" aria-hidden="true" tabindex="-1"></a>mod1.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(logwages <span class="sc">~</span> age, <span class="at">data =</span> data.df)</span>
<span id="cb64-172"><a href="#cb64-172" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.lm)</span>
<span id="cb64-173"><a href="#cb64-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-174"><a href="#cb64-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-175"><a href="#cb64-175" aria-hidden="true" tabindex="-1"></a>The higher the age of an observation, the higher their wage. If the age of an observation is 1 year higher, the log annual wage of this observation is <span class="in">`r round(mod1.lm$coefficients["age"],4)`</span>. In other words, the wage of an observation is higher by <span class="in">`r (round(exp(mod1.lm$coefficients["age"]), 4)-1)*100`</span>% with an additional year of age (the mean annual wage is <span class="in">`r format(round(mean(exp(data.df$logwages)), 0), scientific=FALSE)`</span>).</span>
<span id="cb64-176"><a href="#cb64-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-177"><a href="#cb64-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-178"><a href="#cb64-178" aria-hidden="true" tabindex="-1"></a><span class="fu">### Between model</span></span>
<span id="cb64-181"><a href="#cb64-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-182"><a href="#cb64-182" aria-hidden="true" tabindex="-1"></a>mod1.btw <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> age, </span>
<span id="cb64-183"><a href="#cb64-183" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>), <span class="co"># id and time</span></span>
<span id="cb64-184"><a href="#cb64-184" aria-hidden="true" tabindex="-1"></a>                <span class="at">effect =</span> <span class="st">"individual"</span>, <span class="co"># individual, time, or twoways as FE? </span></span>
<span id="cb64-185"><a href="#cb64-185" aria-hidden="true" tabindex="-1"></a>                <span class="at">model =</span> <span class="st">"between"</span>,     <span class="co"># between, FE, RE, FD</span></span>
<span id="cb64-186"><a href="#cb64-186" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> data.df)</span>
<span id="cb64-187"><a href="#cb64-187" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.btw)</span>
<span id="cb64-188"><a href="#cb64-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-189"><a href="#cb64-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-190"><a href="#cb64-190" aria-hidden="true" tabindex="-1"></a>The higher the age of an individual, the higher their wage. If the age of an individual is 1 year higher, the log annual wage of this individual is <span class="in">`r round(mod1.btw$coefficients["age"],4)`</span>. In other words, the wage of an individual is higher by <span class="in">`r (round(exp(mod1.btw$coefficients["age"]), 4)-1)*100`</span>% with an additional year of age (the mean annual wage is <span class="in">`r format(round(mean(exp(data.df$logwages)), 0), scientific=FALSE)`</span>).</span>
<span id="cb64-191"><a href="#cb64-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-192"><a href="#cb64-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-193"><a href="#cb64-193" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fixed Effects model</span></span>
<span id="cb64-196"><a href="#cb64-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-197"><a href="#cb64-197" aria-hidden="true" tabindex="-1"></a>mod1.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> age, </span>
<span id="cb64-198"><a href="#cb64-198" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>), <span class="co"># id and time</span></span>
<span id="cb64-199"><a href="#cb64-199" aria-hidden="true" tabindex="-1"></a>                <span class="at">effect =</span> <span class="st">"individual"</span>, <span class="co"># individual, time, or twoways as FE? </span></span>
<span id="cb64-200"><a href="#cb64-200" aria-hidden="true" tabindex="-1"></a>                <span class="at">model =</span> <span class="st">"within"</span>,     <span class="co"># between, FE, RE, FD</span></span>
<span id="cb64-201"><a href="#cb64-201" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> data.df)</span>
<span id="cb64-202"><a href="#cb64-202" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.fe)</span>
<span id="cb64-203"><a href="#cb64-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-204"><a href="#cb64-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster robust standard errors</span></span>
<span id="cb64-205"><a href="#cb64-205" aria-hidden="true" tabindex="-1"></a>vcovx <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(mod1.fe, <span class="at">cluster =</span> <span class="st">"group"</span>, <span class="at">method =</span> <span class="st">"arellano"</span>, <span class="at">type =</span> <span class="st">"HC3"</span>)</span>
<span id="cb64-206"><a href="#cb64-206" aria-hidden="true" tabindex="-1"></a>mod1.fe<span class="sc">$</span>vcov <span class="ot">&lt;-</span> vcovx</span>
<span id="cb64-207"><a href="#cb64-207" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.fe)</span>
<span id="cb64-208"><a href="#cb64-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-209"><a href="#cb64-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-210"><a href="#cb64-210" aria-hidden="true" tabindex="-1"></a>The higher the age of an individual, the higher their wage. If an individual become one year older, the log annual wage of this individual increases by <span class="in">`r round(mod1.fe$coefficients["age"],4)`</span>. In other words, the wage of an individual increases by <span class="in">`r (round(exp(mod1.fe$coefficients["age"]), 4)-1)*100`</span>% with an additional year of age for this individual (the mean annual wage is <span class="in">`r format(round(mean(exp(data.df$logwages)), 0), scientific=FALSE)`</span>).</span>
<span id="cb64-211"><a href="#cb64-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-212"><a href="#cb64-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-213"><a href="#cb64-213" aria-hidden="true" tabindex="-1"></a><span class="fu">### Random Effects model</span></span>
<span id="cb64-216"><a href="#cb64-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-217"><a href="#cb64-217" aria-hidden="true" tabindex="-1"></a>mod1.re <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> age, </span>
<span id="cb64-218"><a href="#cb64-218" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>), <span class="co"># id and time</span></span>
<span id="cb64-219"><a href="#cb64-219" aria-hidden="true" tabindex="-1"></a>                <span class="at">effect =</span> <span class="st">"individual"</span>, <span class="co"># individual, time, or twoways as FE? </span></span>
<span id="cb64-220"><a href="#cb64-220" aria-hidden="true" tabindex="-1"></a>                <span class="at">model =</span> <span class="st">"random"</span>,     <span class="co"># between, FE, RE, FD</span></span>
<span id="cb64-221"><a href="#cb64-221" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> data.df)</span>
<span id="cb64-222"><a href="#cb64-222" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.re)</span>
<span id="cb64-223"><a href="#cb64-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-224"><a href="#cb64-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-225"><a href="#cb64-225" aria-hidden="true" tabindex="-1"></a>The higher the age of an individual, the higher their wage. Well,... I don't actually know how to translate that into a substantive interpretation.</span>
<span id="cb64-226"><a href="#cb64-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-227"><a href="#cb64-227" aria-hidden="true" tabindex="-1"></a><span class="fu">### CRE Random Effects model</span></span>
<span id="cb64-228"><a href="#cb64-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-231"><a href="#cb64-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-232"><a href="#cb64-232" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate group-specific means of ALL X variables</span></span>
<span id="cb64-233"><a href="#cb64-233" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>m_age <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>age,</span>
<span id="cb64-234"><a href="#cb64-234" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> data.df<span class="sc">$</span>pid,</span>
<span id="cb64-235"><a href="#cb64-235" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb64-236"><a href="#cb64-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-237"><a href="#cb64-237" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate in RE model</span></span>
<span id="cb64-238"><a href="#cb64-238" aria-hidden="true" tabindex="-1"></a>mod1.cre <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> age <span class="sc">+</span> m_age, </span>
<span id="cb64-239"><a href="#cb64-239" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>), <span class="co"># id and time</span></span>
<span id="cb64-240"><a href="#cb64-240" aria-hidden="true" tabindex="-1"></a>                <span class="at">effect =</span> <span class="st">"individual"</span>, <span class="co"># individual, time, or twoways as FE? </span></span>
<span id="cb64-241"><a href="#cb64-241" aria-hidden="true" tabindex="-1"></a>                <span class="at">model =</span> <span class="st">"random"</span>,     <span class="co"># between, FE, RE, FD</span></span>
<span id="cb64-242"><a href="#cb64-242" aria-hidden="true" tabindex="-1"></a>                <span class="at">random.method =</span> <span class="st">"walhus"</span>, <span class="co"># to avoid singularities</span></span>
<span id="cb64-243"><a href="#cb64-243" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> data.df)</span>
<span id="cb64-244"><a href="#cb64-244" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1.cre)</span>
<span id="cb64-245"><a href="#cb64-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-246"><a href="#cb64-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-247"><a href="#cb64-247" aria-hidden="true" tabindex="-1"></a>1) If an individual become one year older, the log annual wage of this individual increases by <span class="in">`r round(mod1.cre$coefficients["age"],4)`</span>. In other words, the wage of an individual increases by <span class="in">`r (round(exp(mod1.cre$coefficients["age"]), 4)-1)*100`</span>% with an additional year of age for this individual.</span>
<span id="cb64-248"><a href="#cb64-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-249"><a href="#cb64-249" aria-hidden="true" tabindex="-1"></a>2) If the age of an individual is 1 year higher, the log annual wage of this individual is <span class="in">`r round(mod1.cre$coefficients["m_age"] + mod1.cre$coefficients["age"],4)`</span> (<span class="in">`r round(mod1.cre$coefficients["m_age"],4)`</span> + <span class="in">`r round(mod1.cre$coefficients["age"],4)`</span>). In other words, the wage of an individual is higher by <span class="in">`r (round(exp(mod1.cre$coefficients["m_age"] + mod1.cre$coefficients["age"]), 4)-1)*100`</span>% with an additional year of age</span>
<span id="cb64-250"><a href="#cb64-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-251"><a href="#cb64-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-252"><a href="#cb64-252" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exercise 3</span></span>
<span id="cb64-253"><a href="#cb64-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-254"><a href="#cb64-254" aria-hidden="true" tabindex="-1"></a>Can we use this dataset to replicate our earlier analysis on the marital wage premium? What might be a problem here? (tip: have a look a the marriage variable).</span>
<span id="cb64-255"><a href="#cb64-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-258"><a href="#cb64-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-259"><a href="#cb64-259" aria-hidden="true" tabindex="-1"></a><span class="do">### Lets check if variable are time-varying or constant</span></span>
<span id="cb64-260"><a href="#cb64-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-261"><a href="#cb64-261" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(data.df, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">ave</span>(x, data.df<span class="sc">$</span>pid, <span class="at">FUN =</span> sd)))</span>
<span id="cb64-262"><a href="#cb64-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-263"><a href="#cb64-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-264"><a href="#cb64-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-265"><a href="#cb64-265" aria-hidden="true" tabindex="-1"></a>The variable married is time-constant and does not have any within-person variance. This is somehow not very useful, as marital status obviously is not a time-constant trait.</span>
<span id="cb64-266"><a href="#cb64-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-267"><a href="#cb64-267" aria-hidden="true" tabindex="-1"></a>However, we do something similar: is there a fatherhood wage premium? In other words, do men experience an increase in wages when they become fathers?</span>
<span id="cb64-268"><a href="#cb64-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-269"><a href="#cb64-269" aria-hidden="true" tabindex="-1"></a><span class="in">    * Restrict the age at the start (first wage) to people aged 25-35</span></span>
<span id="cb64-270"><a href="#cb64-270" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb64-273"><a href="#cb64-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-274"><a href="#cb64-274" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ] <span class="co"># just to be sure</span></span>
<span id="cb64-275"><a href="#cb64-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-276"><a href="#cb64-276" aria-hidden="true" tabindex="-1"></a><span class="co"># Person year number</span></span>
<span id="cb64-277"><a href="#cb64-277" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>pynr <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>year,</span>
<span id="cb64-278"><a href="#cb64-278" aria-hidden="true" tabindex="-1"></a>                data.df<span class="sc">$</span>pid,</span>
<span id="cb64-279"><a href="#cb64-279" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x))</span>
<span id="cb64-280"><a href="#cb64-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-281"><a href="#cb64-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Age at first wave</span></span>
<span id="cb64-282"><a href="#cb64-282" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_age <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>pynr <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>age, <span class="cn">NA</span>)</span>
<span id="cb64-283"><a href="#cb64-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-284"><a href="#cb64-284" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute across individual, using mean and na.rm = TRUE</span></span>
<span id="cb64-285"><a href="#cb64-285" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_age <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>f_age,</span>
<span id="cb64-286"><a href="#cb64-286" aria-hidden="true" tabindex="-1"></a>                     data.df<span class="sc">$</span>pid,</span>
<span id="cb64-287"><a href="#cb64-287" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb64-288"><a href="#cb64-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-289"><a href="#cb64-289" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_age)</span>
<span id="cb64-290"><a href="#cb64-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-291"><a href="#cb64-291" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict</span></span>
<span id="cb64-292"><a href="#cb64-292" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>f_age <span class="sc">&lt;=</span> <span class="dv">35</span>,]</span>
<span id="cb64-293"><a href="#cb64-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-294"><a href="#cb64-294" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-295"><a href="#cb64-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-296"><a href="#cb64-296" aria-hidden="true" tabindex="-1"></a><span class="in">    * Use number of children to construct a binary indicator of wether the is a child in the household or not</span></span>
<span id="cb64-297"><a href="#cb64-297" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb64-300"><a href="#cb64-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-301"><a href="#cb64-301" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>child_hh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>child <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb64-302"><a href="#cb64-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-303"><a href="#cb64-303" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>child, data.df<span class="sc">$</span>child_hh)</span>
<span id="cb64-304"><a href="#cb64-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-305"><a href="#cb64-305" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-306"><a href="#cb64-306" aria-hidden="true" tabindex="-1"></a><span class="in">    * Make sure we start only with men who are not yet fathers.</span></span>
<span id="cb64-307"><a href="#cb64-307" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb64-310"><a href="#cb64-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-311"><a href="#cb64-311" aria-hidden="true" tabindex="-1"></a><span class="co"># Child status at first wave</span></span>
<span id="cb64-312"><a href="#cb64-312" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_child_hh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>pynr <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>child_hh, <span class="cn">NA</span>)</span>
<span id="cb64-313"><a href="#cb64-313" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_child_hh) <span class="co"># More than 1,500 individuals are already child_hh from the start on</span></span>
<span id="cb64-314"><a href="#cb64-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-315"><a href="#cb64-315" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute across individual, using mean and na.rm = TRUE</span></span>
<span id="cb64-316"><a href="#cb64-316" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>f_child_hh,</span>
<span id="cb64-317"><a href="#cb64-317" aria-hidden="true" tabindex="-1"></a>                         data.df<span class="sc">$</span>pid,</span>
<span id="cb64-318"><a href="#cb64-318" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb64-319"><a href="#cb64-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-320"><a href="#cb64-320" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_child_hh)</span>
<span id="cb64-321"><a href="#cb64-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-322"><a href="#cb64-322" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop those who are child_hh from the start</span></span>
<span id="cb64-323"><a href="#cb64-323" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>f_child_hh <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb64-324"><a href="#cb64-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-325"><a href="#cb64-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-326"><a href="#cb64-326" aria-hidden="true" tabindex="-1"></a>__Note: this feels like dropping a lot of information! However, it makes sense if we want to correctly identify the effect of interest.__</span>
<span id="cb64-327"><a href="#cb64-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-328"><a href="#cb64-328" aria-hidden="true" tabindex="-1"></a><span class="in">    * Do we need to drop observations where people go from child to no child?</span></span>
<span id="cb64-329"><a href="#cb64-329" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb64-332"><a href="#cb64-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-333"><a href="#cb64-333" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb64-334"><a href="#cb64-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-335"><a href="#cb64-335" aria-hidden="true" tabindex="-1"></a><span class="co"># Change in child status within an id</span></span>
<span id="cb64-336"><a href="#cb64-336" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>fd_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb64-337"><a href="#cb64-337" aria-hidden="true" tabindex="-1"></a>                          data.df<span class="sc">$</span>pid,</span>
<span id="cb64-338"><a href="#cb64-338" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span>(x) x <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(x, <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>)) <span class="co"># 0 instead of NA for 1st year</span></span>
<span id="cb64-339"><a href="#cb64-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-340"><a href="#cb64-340" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>fd_child_hh)</span>
<span id="cb64-341"><a href="#cb64-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-342"><a href="#cb64-342" aria-hidden="true" tabindex="-1"></a><span class="co"># There are indeed people going from child to "no child"</span></span>
<span id="cb64-343"><a href="#cb64-343" aria-hidden="true" tabindex="-1"></a><span class="co"># It might be that children leave the households, or parents get divorced?</span></span>
<span id="cb64-344"><a href="#cb64-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-345"><a href="#cb64-345" aria-hidden="true" tabindex="-1"></a><span class="co"># One should usually look into this more carefully, but here let's just drop those observations.</span></span>
<span id="cb64-346"><a href="#cb64-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-347"><a href="#cb64-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-348"><a href="#cb64-348" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark observations starting with a negative fd value (jump from marry=1 to marry =0)</span></span>
<span id="cb64-349"><a href="#cb64-349" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>notstag_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(<span class="fu">ifelse</span>(data.df<span class="sc">$</span>fd_child_hh <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb64-350"><a href="#cb64-350" aria-hidden="true" tabindex="-1"></a>                               data.df<span class="sc">$</span>pid,</span>
<span id="cb64-351"><a href="#cb64-351" aria-hidden="true" tabindex="-1"></a>                               <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">cumsum</span>(x))</span>
<span id="cb64-352"><a href="#cb64-352" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>notstag_child_hh)</span>
<span id="cb64-353"><a href="#cb64-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-354"><a href="#cb64-354" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop after "loosing a child"</span></span>
<span id="cb64-355"><a href="#cb64-355" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>notstag_child_hh <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb64-356"><a href="#cb64-356" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>fd_child_hh)</span>
<span id="cb64-357"><a href="#cb64-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span>    </span>
<span id="cb64-358"><a href="#cb64-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-359"><a href="#cb64-359" aria-hidden="true" tabindex="-1"></a><span class="in">    * Calculate the effect of having a child on the wage of men (including controls if reasonable). </span></span>
<span id="cb64-360"><a href="#cb64-360" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb64-361"><a href="#cb64-361" aria-hidden="true" tabindex="-1"></a><span class="in">    * Calculate effects for POLS, RE, and FE (if you have some extra time, also FEIS). (#Hint: feis needs a class `data.frame` as input data)</span></span>
<span id="cb64-362"><a href="#cb64-362" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb64-365"><a href="#cb64-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-366"><a href="#cb64-366" aria-hidden="true" tabindex="-1"></a><span class="co"># Age intervals</span></span>
<span id="cb64-367"><a href="#cb64-367" aria-hidden="true" tabindex="-1"></a>int <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>, <span class="fu">max</span>(data.df<span class="sc">$</span>age), <span class="dv">5</span>)</span>
<span id="cb64-368"><a href="#cb64-368" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>age_gr <span class="ot">&lt;-</span> <span class="fu">cut</span>(data.df<span class="sc">$</span>age, int, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-369"><a href="#cb64-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-370"><a href="#cb64-370" aria-hidden="true" tabindex="-1"></a><span class="co"># Formula with controls</span></span>
<span id="cb64-371"><a href="#cb64-371" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(logwages <span class="sc">~</span> child_hh <span class="sc">+</span> </span>
<span id="cb64-372"><a href="#cb64-372" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb64-373"><a href="#cb64-373" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb64-374"><a href="#cb64-374" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb64-375"><a href="#cb64-375" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6)</span>
<span id="cb64-376"><a href="#cb64-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-377"><a href="#cb64-377" aria-hidden="true" tabindex="-1"></a><span class="do">### POLS</span></span>
<span id="cb64-378"><a href="#cb64-378" aria-hidden="true" tabindex="-1"></a>mod.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(fm, <span class="at">data =</span> data.df)</span>
<span id="cb64-379"><a href="#cb64-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-380"><a href="#cb64-380" aria-hidden="true" tabindex="-1"></a><span class="do">### RE</span></span>
<span id="cb64-381"><a href="#cb64-381" aria-hidden="true" tabindex="-1"></a>mod.re <span class="ot">&lt;-</span> <span class="fu">plm</span>(fm, <span class="at">data =</span> data.df,</span>
<span id="cb64-382"><a href="#cb64-382" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb64-383"><a href="#cb64-383" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"random"</span>)</span>
<span id="cb64-384"><a href="#cb64-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-385"><a href="#cb64-385" aria-hidden="true" tabindex="-1"></a><span class="do">### FE</span></span>
<span id="cb64-386"><a href="#cb64-386" aria-hidden="true" tabindex="-1"></a>mod.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(fm, <span class="at">data =</span> data.df,</span>
<span id="cb64-387"><a href="#cb64-387" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb64-388"><a href="#cb64-388" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb64-389"><a href="#cb64-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-390"><a href="#cb64-390" aria-hidden="true" tabindex="-1"></a><span class="do">### FEIS</span></span>
<span id="cb64-391"><a href="#cb64-391" aria-hidden="true" tabindex="-1"></a><span class="co"># GIven that we have a relatively large T, we can actually use the 5 tenure dummies here</span></span>
<span id="cb64-392"><a href="#cb64-392" aria-hidden="true" tabindex="-1"></a>mod.feis <span class="ot">&lt;-</span> <span class="fu">feis</span>(logwages <span class="sc">~</span> child_hh <span class="sc">+</span> </span>
<span id="cb64-393"><a href="#cb64-393" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb64-394"><a href="#cb64-394" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb64-395"><a href="#cb64-395" aria-hidden="true" tabindex="-1"></a>                   smsa <span class="sc">+</span> </span>
<span id="cb64-396"><a href="#cb64-396" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.factor</span>(year) <span class="sc">|</span> ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, <span class="co"># Note we add year manually here</span></span>
<span id="cb64-397"><a href="#cb64-397" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">data.frame</span>(data.df),</span>
<span id="cb64-398"><a href="#cb64-398" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>), <span class="at">robust =</span> <span class="cn">TRUE</span>) <span class="co"># we use the cluster-robust SEs right away</span></span>
<span id="cb64-399"><a href="#cb64-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-400"><a href="#cb64-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-401"><a href="#cb64-401" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-402"><a href="#cb64-402" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb64-403"><a href="#cb64-403" aria-hidden="true" tabindex="-1"></a><span class="in">    * Compare using cluster robust standard errors (and screenreg).</span></span>
<span id="cb64-404"><a href="#cb64-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-407"><a href="#cb64-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-408"><a href="#cb64-408" aria-hidden="true" tabindex="-1"></a><span class="do">### Cluster robust SEs for RE and FE</span></span>
<span id="cb64-409"><a href="#cb64-409" aria-hidden="true" tabindex="-1"></a>vcov.re <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(mod.re, <span class="at">cluster =</span> <span class="st">"group"</span>, <span class="at">method =</span> <span class="st">"arellano"</span>, <span class="at">type =</span> <span class="st">"HC3"</span>)</span>
<span id="cb64-410"><a href="#cb64-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-411"><a href="#cb64-411" aria-hidden="true" tabindex="-1"></a>vcov.fe <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(mod.fe, <span class="at">cluster =</span> <span class="st">"group"</span>, <span class="at">method =</span> <span class="st">"arellano"</span>, <span class="at">type =</span> <span class="st">"HC3"</span>)</span>
<span id="cb64-412"><a href="#cb64-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-413"><a href="#cb64-413" aria-hidden="true" tabindex="-1"></a><span class="co"># Plug into model object</span></span>
<span id="cb64-414"><a href="#cb64-414" aria-hidden="true" tabindex="-1"></a>mod.re<span class="sc">$</span>vcov <span class="ot">&lt;-</span> vcov.re</span>
<span id="cb64-415"><a href="#cb64-415" aria-hidden="true" tabindex="-1"></a>mod.fe<span class="sc">$</span>vcov <span class="ot">&lt;-</span> vcov.fe</span>
<span id="cb64-416"><a href="#cb64-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-417"><a href="#cb64-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-418"><a href="#cb64-418" aria-hidden="true" tabindex="-1"></a><span class="do">### Compare</span></span>
<span id="cb64-419"><a href="#cb64-419" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(<span class="fu">list</span>(mod.lm, mod.re, mod.fe, mod.feis), <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb64-420"><a href="#cb64-420" aria-hidden="true" tabindex="-1"></a>          <span class="at">custom.model.names =</span> <span class="fu">c</span>(<span class="st">"POLS"</span>, <span class="st">"RE"</span>, <span class="st">"FE"</span>, <span class="st">"FEIS"</span>), </span>
<span id="cb64-421"><a href="#cb64-421" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.groups =</span> <span class="cn">FALSE</span>, <span class="co"># don't know why include.groups = FALSE is necessary here</span></span>
<span id="cb64-422"><a href="#cb64-422" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.coef =</span> <span class="st">"year"</span>) </span>
<span id="cb64-423"><a href="#cb64-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-424"><a href="#cb64-424" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-425"><a href="#cb64-425" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Interpret the results </span>
<span id="cb64-426"><a href="#cb64-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-427"><a href="#cb64-427" aria-hidden="true" tabindex="-1"></a>We can interpret the results above as follows:</span>
<span id="cb64-428"><a href="#cb64-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-429"><a href="#cb64-429" aria-hidden="true" tabindex="-1"></a>POLS and RE: Observations with at least one child in the household tend to have higher annual wages</span>
<span id="cb64-430"><a href="#cb64-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-431"><a href="#cb64-431" aria-hidden="true" tabindex="-1"></a>FE: If men become fathers, this increases their annual wage by ~ 4%. The effect is significant (would be highly significant without cluster robust SEs).</span>
<span id="cb64-432"><a href="#cb64-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-433"><a href="#cb64-433" aria-hidden="true" tabindex="-1"></a>FEIS: Given the heterogeneous wage trajectories, if men become fathers, this increases their annual wage by ~ 5%. </span>
<span id="cb64-434"><a href="#cb64-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-435"><a href="#cb64-435" aria-hidden="true" tabindex="-1"></a>In this case, FEIS estimates a higher premium than FE. This could indicate that those with steeper wage trajectories actually are less likely to get children or get their children later.</span>
<span id="cb64-436"><a href="#cb64-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-437"><a href="#cb64-437" aria-hidden="true" tabindex="-1"></a>Do you know why FEIS has a lower $N$ than the other models?</span>
<span id="cb64-438"><a href="#cb64-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-439"><a href="#cb64-439" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-440"><a href="#cb64-440" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>Try to perform a placebo test: what happens if you use the "lead" of becoming father. Why is this an interesting test?</span>
<span id="cb64-441"><a href="#cb64-441" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb64-444"><a href="#cb64-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-445"><a href="#cb64-445" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb64-446"><a href="#cb64-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-447"><a href="#cb64-447" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag </span></span>
<span id="cb64-448"><a href="#cb64-448" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>lag_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb64-449"><a href="#cb64-449" aria-hidden="true" tabindex="-1"></a>                            data.df<span class="sc">$</span>pid,</span>
<span id="cb64-450"><a href="#cb64-450" aria-hidden="true" tabindex="-1"></a>                            <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">lag</span>(x, <span class="dv">2</span>)) <span class="co"># lets use two years</span></span>
<span id="cb64-451"><a href="#cb64-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-452"><a href="#cb64-452" aria-hidden="true" tabindex="-1"></a><span class="co"># Lead</span></span>
<span id="cb64-453"><a href="#cb64-453" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>lead_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb64-454"><a href="#cb64-454" aria-hidden="true" tabindex="-1"></a>                             data.df<span class="sc">$</span>pid,</span>
<span id="cb64-455"><a href="#cb64-455" aria-hidden="true" tabindex="-1"></a>                             <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">lead</span>(x, <span class="dv">2</span>)) <span class="co"># lets use two years</span></span>
<span id="cb64-456"><a href="#cb64-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-457"><a href="#cb64-457" aria-hidden="true" tabindex="-1"></a><span class="do">### Estimate FE models</span></span>
<span id="cb64-458"><a href="#cb64-458" aria-hidden="true" tabindex="-1"></a>lag.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> lag_child_hh <span class="sc">+</span> </span>
<span id="cb64-459"><a href="#cb64-459" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb64-460"><a href="#cb64-460" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb64-461"><a href="#cb64-461" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb64-462"><a href="#cb64-462" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, </span>
<span id="cb64-463"><a href="#cb64-463" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> data.df,</span>
<span id="cb64-464"><a href="#cb64-464" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb64-465"><a href="#cb64-465" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb64-466"><a href="#cb64-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-467"><a href="#cb64-467" aria-hidden="true" tabindex="-1"></a>lead.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> lead_child_hh <span class="sc">+</span> </span>
<span id="cb64-468"><a href="#cb64-468" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb64-469"><a href="#cb64-469" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb64-470"><a href="#cb64-470" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb64-471"><a href="#cb64-471" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, </span>
<span id="cb64-472"><a href="#cb64-472" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> data.df,</span>
<span id="cb64-473"><a href="#cb64-473" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb64-474"><a href="#cb64-474" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb64-475"><a href="#cb64-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-476"><a href="#cb64-476" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare</span></span>
<span id="cb64-477"><a href="#cb64-477" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(<span class="fu">list</span>(lag.fe, lead.fe), <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb64-478"><a href="#cb64-478" aria-hidden="true" tabindex="-1"></a>          <span class="at">custom.coef.map =</span> <span class="fu">list</span>(<span class="at">lag_child_hh =</span> <span class="st">"Lag Child"</span>, </span>
<span id="cb64-479"><a href="#cb64-479" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lead_child_hh =</span> <span class="st">"Lead Child"</span>))</span>
<span id="cb64-480"><a href="#cb64-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-481"><a href="#cb64-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-482"><a href="#cb64-482" aria-hidden="true" tabindex="-1"></a>Interestingly we already see a significant and non-trivial fatherhood effect on the wage two years before the future father actually become fathers.</span>
<span id="cb64-483"><a href="#cb64-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-484"><a href="#cb64-484" aria-hidden="true" tabindex="-1"></a>If we observe a treatment effect for a treatment that has not yet happened, this might indicate either 1) anticipation effects, or 2) that something is actually confounding our treatment (e.g. selection on pre-treatment trends)</span>
<span id="cb64-485"><a href="#cb64-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-486"><a href="#cb64-486" aria-hidden="true" tabindex="-1"></a>What do you think, what might be happening here?</span>
<span id="cb64-487"><a href="#cb64-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-488"><a href="#cb64-488" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exercise 4</span></span>
<span id="cb64-489"><a href="#cb64-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-490"><a href="#cb64-490" aria-hidden="true" tabindex="-1"></a>Can we use one of the new event-study approaches, such as the Callaway and SantAnna estimator?</span>
<span id="cb64-491"><a href="#cb64-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-492"><a href="#cb64-492" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Preprocess data (treatment group and timing indicator)</span>
<span id="cb64-493"><a href="#cb64-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-496"><a href="#cb64-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-497"><a href="#cb64-497" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment timing = year if child in household</span></span>
<span id="cb64-498"><a href="#cb64-498" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>child_hh <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>year, <span class="cn">NA</span>)</span>
<span id="cb64-499"><a href="#cb64-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-500"><a href="#cb64-500" aria-hidden="true" tabindex="-1"></a><span class="co"># Define those who never have a child</span></span>
<span id="cb64-501"><a href="#cb64-501" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>tmp <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb64-502"><a href="#cb64-502" aria-hidden="true" tabindex="-1"></a>                   data.df<span class="sc">$</span>pid,</span>
<span id="cb64-503"><a href="#cb64-503" aria-hidden="true" tabindex="-1"></a>                   <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb64-504"><a href="#cb64-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-505"><a href="#cb64-505" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>never_child <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>tmp <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb64-506"><a href="#cb64-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-507"><a href="#cb64-507" aria-hidden="true" tabindex="-1"></a><span class="co"># set never treated to zero</span></span>
<span id="cb64-508"><a href="#cb64-508" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing[data.df<span class="sc">$</span>never_child <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb64-509"><a href="#cb64-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-510"><a href="#cb64-510" aria-hidden="true" tabindex="-1"></a><span class="co"># if married is not NA, used min year per id (removing NAs)</span></span>
<span id="cb64-511"><a href="#cb64-511" aria-hidden="true" tabindex="-1"></a>oo <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(data.df<span class="sc">$</span>child_hh))</span>
<span id="cb64-512"><a href="#cb64-512" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing[oo] <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>treat_timing[oo],</span>
<span id="cb64-513"><a href="#cb64-513" aria-hidden="true" tabindex="-1"></a>                                data.df<span class="sc">$</span>pid[oo],</span>
<span id="cb64-514"><a href="#cb64-514" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb64-515"><a href="#cb64-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-516"><a href="#cb64-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-517"><a href="#cb64-517" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data.df[, <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>, <span class="st">"child_hh"</span>, <span class="st">"never_child"</span>, <span class="st">"treat_timing"</span>)], <span class="at">n =</span> <span class="dv">35</span>)</span>
<span id="cb64-518"><a href="#cb64-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-519"><a href="#cb64-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-520"><a href="#cb64-520" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Estimate the model using <span class="in">`att_gt`</span></span>
<span id="cb64-521"><a href="#cb64-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-522"><a href="#cb64-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb64-523"><a href="#cb64-523" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate group-time average treatment effects using att_gt method</span></span>
<span id="cb64-524"><a href="#cb64-524" aria-hidden="true" tabindex="-1"></a>wages.attgt <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"logwages"</span>,</span>
<span id="cb64-525"><a href="#cb64-525" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb64-526"><a href="#cb64-526" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idname =</span> <span class="st">"pid"</span>,</span>
<span id="cb64-527"><a href="#cb64-527" aria-hidden="true" tabindex="-1"></a>                      <span class="at">gname =</span> <span class="st">"treat_timing"</span>,</span>
<span id="cb64-528"><a href="#cb64-528" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xformla =</span> <span class="sc">~</span> hours <span class="sc">+</span> age_gr,</span>
<span id="cb64-529"><a href="#cb64-529" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> data.df,</span>
<span id="cb64-530"><a href="#cb64-530" aria-hidden="true" tabindex="-1"></a>                      <span class="at">allow_unbalanced_panel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb64-531"><a href="#cb64-531" aria-hidden="true" tabindex="-1"></a>                      <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb64-532"><a href="#cb64-532" aria-hidden="true" tabindex="-1"></a>                      <span class="at">est_method =</span> <span class="st">"ipw"</span></span>
<span id="cb64-533"><a href="#cb64-533" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb64-534"><a href="#cb64-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-535"><a href="#cb64-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-536"><a href="#cb64-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-537"><a href="#cb64-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-540"><a href="#cb64-540" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-541"><a href="#cb64-541" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the group-time specific estimates</span></span>
<span id="cb64-542"><a href="#cb64-542" aria-hidden="true" tabindex="-1"></a>wages.dyn <span class="ot">&lt;-</span> <span class="fu">aggte</span>(wages.attgt, <span class="at">type =</span> <span class="st">"dynamic"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb64-543"><a href="#cb64-543" aria-hidden="true" tabindex="-1"></a>                   <span class="at">min_e =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">max_e =</span> <span class="dv">6</span>)</span>
<span id="cb64-544"><a href="#cb64-544" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wages.dyn)</span>
<span id="cb64-545"><a href="#cb64-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-546"><a href="#cb64-546" aria-hidden="true" tabindex="-1"></a>zp3 <span class="ot">&lt;-</span> <span class="fu">ggdid</span>(wages.dyn) </span>
<span id="cb64-547"><a href="#cb64-547" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-548"><a href="#cb64-548" aria-hidden="true" tabindex="-1"></a>zp3 <span class="ot">&lt;-</span> zp3 <span class="sc">+</span> </span>
<span id="cb64-549"><a href="#cb64-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="fu">gray</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb64-550"><a href="#cb64-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb64-551"><a href="#cb64-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-552"><a href="#cb64-552" aria-hidden="true" tabindex="-1"></a>zp3</span>
<span id="cb64-553"><a href="#cb64-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-554"><a href="#cb64-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-555"><a href="#cb64-555" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Interpret the results </span>
<span id="cb64-556"><a href="#cb64-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-557"><a href="#cb64-557" aria-hidden="true" tabindex="-1"></a>The event-time results above again tell a little different story. First, hose getting father already have a little higher wage two and three years before they become fathers. Then, there is a negative anticipation effect in the year before birth (why could this be plausible?). After birth of the first child, fathers' wages increase significantly more then the wages of non-fathers (however, this is not much more than the effect in year -3).</span>
<span id="cb64-558"><a href="#cb64-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-559"><a href="#cb64-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-560"><a href="#cb64-560" aria-hidden="true" tabindex="-1"></a><span class="fu"># References</span></span>
<span id="cb64-561"><a href="#cb64-561" aria-hidden="true" tabindex="-1"></a>  </span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>