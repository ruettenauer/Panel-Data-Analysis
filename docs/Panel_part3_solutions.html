<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tobias Rüttenauer">

<title>Panel Data Analysis - Solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Panel Data Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Panel_part1.html" rel="" target="">
 <span class="menu-text">1) Panel data methods</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Panel_part2.html" rel="" target="">
 <span class="menu-text">2) Advanced Methods</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Panel_part3.html" rel="" target="">
 <span class="menu-text">3) Exercises</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Panel_part3_solutions.html" rel="" target="" aria-current="page">
 <span class="menu-text">Solutions</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://ruettenauer.github.io/Panel-Data-Analysis/">
            Source Code
            </a>
          </li>
      </ul>
    </div>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#required-packages" id="toc-required-packages" class="nav-link active" data-scroll-target="#required-packages">Required packages</a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise 1</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise 2</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise 3</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Solutions</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://ruettenauer.github.io/">Tobias Rüttenauer</a> <a href="https://orcid.org/0000-0001-5747-9735" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            UCL Social Research Institute
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  

</header>

<section id="required-packages" class="level3">
<h3 class="anchored" data-anchor-id="required-packages">Required packages</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"plm"</span>, <span class="st">"feisr"</span>, <span class="st">"sandwich"</span>, <span class="st">"did"</span>, <span class="st">"texreg"</span>, <span class="st">"tidyr"</span>, <span class="st">"haven"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"ggforce"</span>) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(pkgs, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="session-info" class="level3">
<h3 class="anchored" data-anchor-id="session-info">Session info</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19044)

Matrix products: default


locale:
[1] LC_COLLATE=English_United Kingdom.utf8 
[2] LC_CTYPE=English_United Kingdom.utf8   
[3] LC_MONETARY=English_United Kingdom.utf8
[4] LC_NUMERIC=C                           
[5] LC_TIME=English_United Kingdom.utf8    

time zone: Europe/London
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ggforce_0.4.1  ggplot2_3.4.2  dplyr_1.1.2    haven_2.5.3    tidyr_1.3.0   
 [6] texreg_1.38.6  did_2.1.2      sandwich_3.0-2 feisr_1.3.0    plm_2.6-3     

loaded via a namespace (and not attached):
 [1] gtable_0.3.3        xfun_0.39           htmlwidgets_1.6.2  
 [4] rstatix_0.7.2       collapse_1.9.6      lattice_0.21-8     
 [7] numDeriv_2016.8-1.1 vctrs_0.6.3         tools_4.3.1        
[10] Rdpack_2.4          generics_0.1.3      parallel_4.3.1     
[13] tibble_3.2.1        fansi_1.0.4         pkgconfig_2.0.3    
[16] Matrix_1.5-4.1      data.table_1.14.8   lifecycle_1.0.3    
[19] farver_2.1.1        compiler_4.3.1      maxLik_1.5-2       
[22] munsell_0.5.0       carData_3.0-5       htmltools_0.5.5    
[25] yaml_2.3.7          Formula_1.2-5       pillar_1.9.0       
[28] car_3.1-2           ggpubr_0.6.0        MASS_7.3-60        
[31] abind_1.4-5         nlme_3.1-162        tidyselect_1.2.0   
[34] bdsmatrix_1.3-6     digest_0.6.32       purrr_1.0.1        
[37] forcats_1.0.0       miscTools_0.6-28    polyclip_1.10-4    
[40] fastmap_1.1.1       grid_4.3.1          colorspace_2.1-0   
[43] cli_3.6.1           lfe_2.9-0           magrittr_2.0.3     
[46] utf8_1.2.3          broom_1.0.5         withr_2.5.0        
[49] dreamerr_1.2.3      scales_1.2.1        backports_1.4.1    
[52] httr_1.4.6          rmarkdown_2.23      ggsignif_0.6.4     
[55] hms_1.1.3           zoo_1.8-12          evaluate_0.21      
[58] knitr_1.43          rbibutils_2.2.13    lmtest_0.9-40      
[61] fixest_0.11.1       rlang_1.1.1         Rcpp_1.0.10        
[64] xtable_1.8-4        glue_1.6.2          tweenr_2.0.2       
[67] BMisc_1.4.5         rstudioapi_0.14     jsonlite_1.8.5     
[70] R6_2.5.1           </code></pre>
</div>
</div>
</section>
<section id="load-data" class="level3">
<h3 class="anchored" data-anchor-id="load-data">Load data</h3>
<p>For the purpose of this exercise, we will use a real-world data set. However, instead of constructing our own data, we use a shortcut and use data from the replication package of <span class="citation" data-cites="Hospido.2012">Hospido (<a href="#ref-Hospido.2012" role="doc-biblioref">2012</a>)</span>. The replication package can be found <a href="http://qed.econ.queensu.ca/jae/datasets/hospido001/">here</a>.</p>
<p>THis is an unbalanced panel with 32,066 observations and 2066 individuals for the period 1968–1993 of the PSID. It consists of male heads aged 25–55 with at least 9 years of usable wages data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load stata file</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"_data/h-data.dta"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets order this</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(data.df)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>, names[<span class="sc">-</span><span class="fu">which</span>(names <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>))])</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[, names]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th>variable name</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pid</td>
<td>INDIVIDUAL IDENTIFIER</td>
</tr>
<tr class="even">
<td>year</td>
<td>YEAR OF INTERVIEW</td>
</tr>
<tr class="odd">
<td>age</td>
<td>AGE OF INDIVIDUAL</td>
</tr>
<tr class="even">
<td>white</td>
<td>WHITE DUMMY</td>
</tr>
<tr class="odd">
<td>dropout</td>
<td>DROPOUT DUMMY</td>
</tr>
<tr class="even">
<td>grad</td>
<td>GRADUATE DUMMY</td>
</tr>
<tr class="odd">
<td>college</td>
<td>COLLEGE DUMMY</td>
</tr>
<tr class="even">
<td>married</td>
<td>MARRIED DUMMY</td>
</tr>
<tr class="odd">
<td>child</td>
<td>NUMBER OF CHILDREN</td>
</tr>
<tr class="even">
<td>fsize</td>
<td>FAMILY SIZE</td>
</tr>
<tr class="odd">
<td>hours</td>
<td>YEARLY HOURS OF WORK</td>
</tr>
<tr class="even">
<td>logwages</td>
<td>LOG OF REAL ANNUAL WAGES</td>
</tr>
<tr class="odd">
<td>changejob</td>
<td>JOB CHANGE DUMMY</td>
</tr>
<tr class="even">
<td>ten1</td>
<td>TENURE DUMMY less than a year</td>
</tr>
<tr class="odd">
<td>ten2</td>
<td>TENURE DUMMY a year</td>
</tr>
<tr class="even">
<td>ten3</td>
<td>TENURE DUMMY 2-3 years</td>
</tr>
<tr class="odd">
<td>ten4</td>
<td>TENURE DUMMY 4 through 9 years</td>
</tr>
<tr class="even">
<td>ten5</td>
<td>TENURE DUMMY 10 through 19 years</td>
</tr>
<tr class="odd">
<td>ten6</td>
<td>TENURE DUMMY 20 years or more</td>
</tr>
<tr class="even">
<td>profes</td>
<td>PROFESSIONAL, TECHNICAL, AND KINDRED WORKERS DUMMY</td>
</tr>
<tr class="odd">
<td>admin</td>
<td>MANAGERS AND ADMINISTRATORS DUMMY</td>
</tr>
<tr class="even">
<td>sales</td>
<td>CLERICAL AND SALES WORKERS DUMMY</td>
</tr>
<tr class="odd">
<td>crafts</td>
<td>CRAFTSMAN AND KINDRED WORKERS DUMMY</td>
</tr>
<tr class="even">
<td>operat</td>
<td>OPERATIVES WORKERS DUMMY</td>
</tr>
<tr class="odd">
<td>servic</td>
<td>LABORERS AND SERVICES WORKERS DUMMY</td>
</tr>
<tr class="even">
<td>smsa</td>
<td>SMSA (Standard Metropolitan Statistical Area) DUMMY</td>
</tr>
<tr class="odd">
<td>neast</td>
<td>NORTH-EAST DUMMY</td>
</tr>
<tr class="even">
<td>ncentr</td>
<td>NORTH-CENTRAL DUMMY</td>
</tr>
<tr class="odd">
<td>south</td>
<td>SOUTH DUMMY</td>
</tr>
<tr class="even">
<td>west</td>
<td>WEST DUMMY</td>
</tr>
</tbody>
</table>
</section>
<section id="exercise-1" class="level1">
<h1>Exercise 1</h1>
<p>Can we use this dataset to replicate our earlier analysis on the marital wage premium? What might be a problem here?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Lets check if variable are time-varying or constant</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(data.df, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">ave</span>(x, data.df<span class="sc">$</span>pid, <span class="at">FUN =</span> sd)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$pid
[1] 0

$year
[1] 5.084193

$age
[1] 5.091139

$fsize
[1] 0.8707511

$hours
[1] 371.2656

$child
[1] 0.8319735

$ten1
[1] 0.2655135

$ten2
[1] 0.2251966

$ten3
[1] 0.3190326

$ten4
[1] 0.4291132

$ten5
[1] 0.3305668

$ten6
[1] 0.1446421

$changejob
[1] 0.293274

$logwages
[1] 0.2923183

$white
[1] 0.01130643

$smsa
[1] 0.1294999

$dropout
[1] 0.03838475

$grad
[1] 0.06823993

$college
[1] 0.03114909

$neast
[1] 0.01985548

$ncentr
[1] 0.02750533

$south
[1] 0.03582719

$west
[1] 0.02641131

$married
[1] 0

$profes
[1] 0.1099356

$admin
[1] 0.1295905

$sales
[1] 0.09946584

$crafts
[1] 0.1912406

$operat
[1] 0.1720871

$servic
[1] 0.1322412</code></pre>
</div>
</div>
<p>The variable married is time-constant and does not have any within-person variance. This is somehow not very useful, as marital status obviously is not a time-constant trait.</p>
</section>
<section id="exercise-2" class="level1">
<h1>Exercise 2</h1>
<p>However, we do something similar: is there a fatherhood wage premium? In other words, do men experience an increase in wages when they become fathers?</p>
<pre><code>* Restrict the age at the start (first wage) to people aged 25-35</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ] <span class="co"># just to be sure</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Person year number</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>pynr <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>year,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                data.df<span class="sc">$</span>pid,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Age at first wave</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_age <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>pynr <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>age, <span class="cn">NA</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute across individual, using mean and na.rm = TRUE</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_age <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>f_age,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                     data.df<span class="sc">$</span>pid,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   25    26    27    28    29    30    31    32    33    34    35    36    37 
14803  2973  1417  1091  1155   813   743   496   715   888   678   564   653 
   38    39    40    41    42    43    44    45    46    47    48    49    50 
  618   673   709   553   549   419   398   402   365   296    47    28    20 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>f_age <span class="sc">&lt;=</span> <span class="dv">35</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<pre><code>* Use number of children to construct a binary indicator of wether the is a child in the household or not</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>child_hh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>child <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>child, data.df<span class="sc">$</span>child_hh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    
        0    1
  0  7651    0
  1     0 5428
  2     0 7397
  3     0 3525
  4     0 1207
  5     0  328
  6     0  158
  7     0   42
  8     0   15
  9     0   12
  10    0    8
  11    0    1</code></pre>
</div>
</div>
<pre><code>* Make sure we start only with men who are not yet fathers.</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Child status at first wave</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_child_hh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>pynr <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>child_hh, <span class="cn">NA</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_child_hh) <span class="co"># More than 1,500 individuals are already child_hh from the start on</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
748 859 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute across individual, using mean and na.rm = TRUE</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>f_child_hh,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                         data.df<span class="sc">$</span>pid,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_child_hh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    0     1 
11424 14348 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop those who are child_hh from the start</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>f_child_hh <span class="sc">==</span> <span class="dv">0</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Note: this feels like dropping a lot of information! However, it makes sense if we want to correctly identify the effect of interest.</strong></p>
<pre><code>* Do we need to drop observations where people go from child to no child?</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Change in child status within an id</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>fd_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                          data.df<span class="sc">$</span>pid,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span>(x) x <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(x, <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>)) <span class="co"># 0 instead of NA for 1st year</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>fd_child_hh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   -1     0     1 
  143 10660   621 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are indeed people going from child to "no child"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It might be that children leave the households, or parents get divorced?</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># One should usually look into this more carefully, but here let's just drop those observations.</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark observations starting with a negative fd value (jump from marry=1 to marry =0)</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>notstag_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(<span class="fu">ifelse</span>(data.df<span class="sc">$</span>fd_child_hh <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                               data.df<span class="sc">$</span>pid,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                               <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">cumsum</span>(x))</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>notstag_child_hh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    0     1     2 
10560   821    43 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop after "loosing a child"</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>notstag_child_hh <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>fd_child_hh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   0    1 
9979  581 </code></pre>
</div>
</div>
<pre><code>* Calculate the effect of having a child on th wage of men (including controls if reasonable). 

* Calculate effects for POLS, RE, and FE (if you have some extra time, also FEIS). (#Hint: feis needs a class `data.frame` as input data)</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Age intervals</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>int <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>, <span class="fu">max</span>(data.df<span class="sc">$</span>age), <span class="dv">5</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>age_gr <span class="ot">&lt;-</span> <span class="fu">cut</span>(data.df<span class="sc">$</span>age, int, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Formula with controls</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(logwages <span class="sc">~</span> child_hh <span class="sc">+</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="do">### POLS</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>mod.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(fm, <span class="at">data =</span> data.df)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="do">### RE</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>mod.re <span class="ot">&lt;-</span> <span class="fu">plm</span>(fm, <span class="at">data =</span> data.df,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"random"</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="do">### FE</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>mod.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(fm, <span class="at">data =</span> data.df,</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="do">### FEIS</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co"># GIven that we have a relatively large T, we can actually use the 5 tenure dummies here</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>mod.feis <span class="ot">&lt;-</span> <span class="fu">feis</span>(logwages <span class="sc">~</span> child_hh <span class="sc">+</span> </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>                   smsa <span class="sc">+</span> </span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.factor</span>(year) <span class="sc">|</span> ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, <span class="co"># Note we add year manually here</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">data.frame</span>(data.df),</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>), <span class="at">robust =</span> <span class="cn">TRUE</span>) <span class="co"># we use the cluster-robust SEs right away</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in feis(logwages ~ child_hh + hours + age_gr + profes + admin + : FEIS needs at least n(slopes)+1 observations per group. 
 You specified 6 slope parameter(s) plus intercept, all groups with t &lt;= 7 dropped</code></pre>
</div>
</div>
<pre><code>* Compare using cluster robust standard errors (and screenreg).</code></pre>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Cluster robust SEs for RE and FE</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>vcov.re <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(mod.re, <span class="at">cluster =</span> <span class="st">"group"</span>, <span class="at">method =</span> <span class="st">"arellano"</span>, <span class="at">type =</span> <span class="st">"HC3"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>vcov.fe <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(mod.fe, <span class="at">cluster =</span> <span class="st">"group"</span>, <span class="at">method =</span> <span class="st">"arellano"</span>, <span class="at">type =</span> <span class="st">"HC3"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plug into model object</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>mod.re<span class="sc">$</span>vcov <span class="ot">&lt;-</span> vcov.re</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>mod.fe<span class="sc">$</span>vcov <span class="ot">&lt;-</span> vcov.fe</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="do">### Compare</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(<span class="fu">list</span>(mod.lm, mod.re, mod.fe, mod.feis), <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">custom.model.names =</span> <span class="fu">c</span>(<span class="st">"POLS"</span>, <span class="st">"RE"</span>, <span class="st">"FE"</span>, <span class="st">"FEIS"</span>), </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.groups =</span> <span class="cn">FALSE</span>, <span class="co"># don't know why include.groups = FALSE is necessary here</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.coef =</span> <span class="st">"year"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=========================================================================
               POLS           RE             FE             FEIS         
-------------------------------------------------------------------------
(Intercept)        8.747 ***      8.976 ***                              
                  (0.051)        (0.106)                                 
child_hh           0.137 ***      0.101 ***      0.040 *        0.055 ** 
                  (0.010)        (0.029)        (0.016)        (0.019)   
hours              0.000 ***      0.000 ***      0.000 ***      0.000 ***
                  (0.000)        (0.000)        (0.000)        (0.000)   
age_gr(30,35]      0.110 ***      0.143 ***      0.008          0.027    
                  (0.012)        (0.019)        (0.013)        (0.015)   
age_gr(35,40]      0.201 ***      0.233 ***     -0.036         -0.023    
                  (0.014)        (0.030)        (0.022)        (0.022)   
age_gr(40,45]      0.239 ***      0.282 ***     -0.131 ***     -0.106 ***
                  (0.019)        (0.042)        (0.031)        (0.032)   
age_gr(45,50]      0.251 ***      0.313 ***     -0.236 ***     -0.208 ***
                  (0.029)        (0.060)        (0.043)        (0.046)   
age_gr(50,55]      0.173 ***      0.264 *       -0.426 ***     -0.444 ***
                  (0.053)        (0.107)        (0.084)        (0.094)   
profes             0.249 ***      0.179 *        0.121 **       0.133 ** 
                  (0.045)        (0.074)        (0.045)        (0.045)   
admin              0.250 ***      0.160 *        0.104 *        0.128 ** 
                  (0.046)        (0.076)        (0.045)        (0.046)   
sales             -0.004          0.057          0.041          0.084    
                  (0.046)        (0.075)        (0.046)        (0.048)   
crafts            -0.031          0.057          0.060          0.091 *  
                  (0.045)        (0.071)        (0.042)        (0.044)   
operat            -0.178 ***      0.032          0.068          0.098 *  
                  (0.046)        (0.076)        (0.045)        (0.047)   
servic            -0.371 ***     -0.028          0.021          0.057    
                  (0.046)        (0.087)        (0.047)        (0.048)   
smsa               0.114 ***      0.023          0.018          0.026    
                  (0.010)        (0.029)        (0.020)        (0.021)   
ten1               0.242 ***      0.112 *        0.101 *                 
                  (0.028)        (0.054)        (0.039)                  
ten2               0.382 ***      0.223 ***      0.209 ***               
                  (0.029)        (0.056)        (0.038)                  
ten3               0.404 ***      0.275 ***      0.263 ***               
                  (0.028)        (0.054)        (0.037)                  
ten4               0.471 ***      0.331 ***      0.308 ***               
                  (0.027)        (0.057)        (0.038)                  
ten5               0.509 ***      0.317 ***      0.270 ***               
                  (0.028)        (0.064)        (0.037)                  
ten6               0.536 ***      0.290 **       0.220 ***               
                  (0.037)        (0.092)        (0.043)                  
-------------------------------------------------------------------------
R^2                0.426          0.374          0.287          0.273    
Adj. R^2           0.425          0.373          0.230          0.270    
Num. obs.      10560          10560          10560          10336        
s_idios                           0.299                                  
s_id                              0.332                                  
s_time                            0.016                                  
RMSE                                                            0.313    
=========================================================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<ul>
<li>Interpret the results</li>
</ul>
<p>We can interpret the results above as follows:</p>
<p>POLS and RE: Observations with at least one child in the household tend to have higher annual wages</p>
<p>FE: If men become fathers, this increases their annual wage by ~ 4%. The effect is significant (would be highly significant without cluster robust SEs).</p>
<p>FEIS: Given the heterogeneous wage trajectories, if men become fathers, this increases their annual wage by ~ 5%.</p>
<p>In this case, FEIS estimates a higher premium than FE. This could indicate that those with steeper wage trajectories actually are less likely to get children or get their children later.</p>
<p>Do you know why FEIS has a lower <span class="math inline">\(N\)</span> than the other models?</p>
<ul>
<li>Try to perform a placebo test: what happens if you use the “lead” of becoming father. Why is this an interesting test?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag </span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>lag_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                            data.df<span class="sc">$</span>pid,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">lag</span>(x, <span class="dv">2</span>)) <span class="co"># lets use two years</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Lead</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>lead_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                             data.df<span class="sc">$</span>pid,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">lead</span>(x, <span class="dv">2</span>)) <span class="co"># lets use two years</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="do">### Estimate FE models</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>lag.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> lag_child_hh <span class="sc">+</span> </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> data.df,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>lead.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> lead_child_hh <span class="sc">+</span> </span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> data.df,</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(<span class="fu">list</span>(lag.fe, lead.fe), <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">custom.coef.map =</span> <span class="fu">list</span>(<span class="at">lag_child_hh =</span> <span class="st">"Lag Child"</span>, </span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lead_child_hh =</span> <span class="st">"Lead Child"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
====================================
            Model 1     Model 2     
------------------------------------
Lag Child      0.025 *              
              (0.011)               
Lead Child                 0.070 ***
                          (0.013)   
------------------------------------
R^2            0.248       0.286    
Adj. R^2       0.176       0.218    
Num. obs.   9064        9064        
====================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<p>Interestingly we already see a significant and non-trivial fatherhood effect on the wage two years before the future father actually become fathers.</p>
<p>If we observe a treatment effect for a treatment that has not yet happened, this might indicate either 1) anticipation effects, or 2) that something is actually confounding our treatment (e.g.&nbsp;selection on pre-treatment trends)</p>
<p>What do you think, what might be happening here?</p>
</section>
<section id="exercise-3" class="level1">
<h1>Exercise 3</h1>
<p>Can we use one of the new event-study approaches, such as the Callaway and SantAnna estimator?</p>
<ul>
<li>Preprocess data (treatment group and timing indicator)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment timing = year if child in household</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>child_hh <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>year, <span class="cn">NA</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define those who never have a child</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>tmp <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                   data.df<span class="sc">$</span>pid,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>never_child <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>tmp <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># set never treated to zero</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing[data.df<span class="sc">$</span>never_child <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># if married is not NA, used min year per id (removing NAs)</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>oo <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(data.df<span class="sc">$</span>child_hh))</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing[oo] <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>treat_timing[oo],</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>                                data.df<span class="sc">$</span>pid[oo],</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data.df[, <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>, <span class="st">"child_hh"</span>, <span class="st">"never_child"</span>, <span class="st">"treat_timing"</span>)], <span class="at">n =</span> <span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 35 × 5
     pid  year child_hh never_child treat_timing
   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
 1 11003  1979        0           1            0
 2 11003  1980        0           1            0
 3 11003  1981        0           1            0
 4 11003  1982        0           1            0
 5 11003  1983        0           1            0
 6 11003  1984        0           1            0
 7 11003  1985        0           1            0
 8 11003  1986        0           1            0
 9 11003  1987        0           1            0
10 11003  1988        0           1            0
# ℹ 25 more rows</code></pre>
</div>
</div>
<ul>
<li>Estimate the model using <code>att_gt</code></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate group-time average treatment effects using att_gt method</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>wages.attgt <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"logwages"</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idname =</span> <span class="st">"pid"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">gname =</span> <span class="st">"treat_timing"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xformla =</span> <span class="sc">~</span> hours <span class="sc">+</span> age_gr,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> data.df,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">allow_unbalanced_panel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">est_method =</span> <span class="st">"ipw"</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the group-time specific estimates</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>wages.dyn <span class="ot">&lt;-</span> <span class="fu">aggte</span>(wages.attgt, <span class="at">type =</span> <span class="st">"dynamic"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">min_e =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">max_e =</span> <span class="dv">6</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wages.dyn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
aggte(MP = wages.attgt, type = "dynamic", min_e = -3, max_e = 6, 
    na.rm = TRUE)

Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  "Difference-in-Differences with Multiple Time Periods." Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. &lt;https://doi.org/10.1016/j.jeconom.2020.12.001&gt;, &lt;https://arxiv.org/abs/1803.09015&gt; 


Overall summary of ATT's based on event-study/dynamic aggregation:  
    ATT    Std. Error     [ 95%  Conf. Int.]  
 0.1035        0.0261     0.0523      0.1546 *


Dynamic Effects:
 Event time Estimate Std. Error [95% Simult.  Conf. Band]  
         -3   0.0589     0.0365       -0.0412      0.1589  
         -2   0.0292     0.0263       -0.0429      0.1013  
         -1  -0.0566     0.0211       -0.1144      0.0013  
          0   0.0424     0.0185       -0.0083      0.0930  
          1   0.0573     0.0236       -0.0074      0.1220  
          2   0.0843     0.0281        0.0073      0.1612 *
          3   0.1103     0.0338        0.0175      0.2031 *
          4   0.1462     0.0349        0.0506      0.2418 *
          5   0.1487     0.0385        0.0430      0.2543 *
          6   0.1353     0.0371        0.0336      0.2370 *
---
Signif. codes: `*' confidence band does not cover 0

Control Group:  Not Yet Treated,  Anticipation Periods:  0
Estimation Method:  Inverse Probability Weighting</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>zp3 <span class="ot">&lt;-</span> <span class="fu">ggdid</span>(wages.dyn) </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>zp3 <span class="ot">&lt;-</span> zp3 <span class="sc">+</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="fu">gray</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>zp3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Panel_part3_solutions_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Interpret the results</li>
</ul>
<p>The event-time results above again tell a little different story. First, hose getting father already have a little higher wage two and three years before they become fathers. Then, there is a negative anticipation effect in the year before birth (why could this be plausible?). After birth of the first child, fathers’ wages increase significantly more then the wages of non-fathers (however, this is not much more than the effect in year -3).</p>
</section>
<section id="references" class="level1">



<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Hospido.2012" class="csl-entry" role="listitem">
Hospido, L. 2012. <span>“Modelling Heterogeneity and Dynamics in the Volatility of Individual Wages.”</span> <em>Journal of Applied Econometrics</em> 27 (3): 386–414. <a href="https://doi.org/10.1002/jae.1204">https://doi.org/10.1002/jae.1204</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb41" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Solutions"</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_depth: 2</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number_sections: true</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Tobias Rüttenauer</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid:  0000-0001-5747-9735</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">    email: t.ruttenauer@ucl.ac.uk</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://ruettenauer.github.io/</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: UCL Social Research Institute</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co">        address: University College London</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co">        city: London WC1H 0AL</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="fu">### Required packages</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, warning = FALSE, results = 'hide'}</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"plm"</span>, <span class="st">"feisr"</span>, <span class="st">"sandwich"</span>, <span class="st">"did"</span>, <span class="st">"texreg"</span>, <span class="st">"tidyr"</span>, <span class="st">"haven"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"ggforce"</span>) </span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(pkgs, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="fu">### Session info</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load data</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>For the purpose of this exercise, we will use a real-world data set. However, instead of constructing our own data, we use a shortcut and use data from the replication package of @Hospido.2012. The replication package can be found <span class="co">[</span><span class="ot">here</span><span class="co">](http://qed.econ.queensu.ca/jae/datasets/hospido001/)</span>.</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>THis is an unbalanced panel with 32,066 observations and 2066 individuals for the period 1968–1993 of the PSID. It consists of male heads aged 25–55 with at least 9 years of usable wages data.</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Load stata file</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"_data/h-data.dta"</span>)</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets order this</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(data.df)</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>, names[<span class="sc">-</span><span class="fu">which</span>(names <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>))])</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[, names]</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>| variable name   |   description|</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>|-----------------|-------------------------------------------------------|</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>| pid             |   INDIVIDUAL IDENTIFIER|</span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>| year            |   YEAR OF INTERVIEW|</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>| age             |   AGE OF INDIVIDUAL|</span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>| white           |   WHITE DUMMY|</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>| dropout         |   DROPOUT DUMMY|</span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>| grad            |   GRADUATE DUMMY|</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>| college         |   COLLEGE DUMMY|</span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>| married         |   MARRIED DUMMY|</span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>| child           |   NUMBER OF CHILDREN|</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>| fsize           |   FAMILY SIZE|</span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>| hours           |   YEARLY HOURS OF WORK|</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>| logwages        |   LOG OF REAL ANNUAL WAGES|</span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>| changejob       |   JOB CHANGE DUMMY|</span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a>| ten1            |   TENURE DUMMY less than a year|</span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>| ten2            |   TENURE DUMMY a year|</span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>| ten3            |   TENURE DUMMY 2-3 years|</span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a>| ten4            |   TENURE DUMMY 4 through 9 years|</span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>| ten5            |   TENURE DUMMY 10 through 19 years|</span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>| ten6            |   TENURE DUMMY 20 years or more|</span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>| profes          |   PROFESSIONAL, TECHNICAL, AND KINDRED WORKERS DUMMY|</span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a>| admin           |   MANAGERS AND ADMINISTRATORS DUMMY|</span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>| sales           |   CLERICAL AND SALES WORKERS DUMMY|</span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a>| crafts          |   CRAFTSMAN AND KINDRED WORKERS DUMMY|</span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a>| operat          |   OPERATIVES WORKERS DUMMY|</span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a>| servic          |   LABORERS AND SERVICES WORKERS DUMMY|</span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a>| smsa            |   SMSA (Standard Metropolitan Statistical Area) DUMMY|</span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a>| neast           |   NORTH-EAST DUMMY|</span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a>| ncentr          |   NORTH-CENTRAL DUMMY|</span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a>| south           |   SOUTH DUMMY|</span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>| west            |   WEST DUMMY|</span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exercise 1</span></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a>Can we use this dataset to replicate our earlier analysis on the marital wage premium? What might be a problem here?</span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a><span class="do">### Lets check if variable are time-varying or constant</span></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(data.df, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">ave</span>(x, data.df<span class="sc">$</span>pid, <span class="at">FUN =</span> sd)))</span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a>The variable married is time-constant and does not have any within-person variance. This is somehow not very useful, as marital status obviously is not a time-constant trait.</span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exercise 2</span></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a>However, we do something similar: is there a fatherhood wage premium? In other words, do men experience an increase in wages when they become fathers?</span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a><span class="in">    * Restrict the age at the start (first wage) to people aged 25-35</span></span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ] <span class="co"># just to be sure</span></span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Person year number</span></span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>pynr <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>year,</span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a>                data.df<span class="sc">$</span>pid,</span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x))</span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Age at first wave</span></span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_age <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>pynr <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>age, <span class="cn">NA</span>)</span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute across individual, using mean and na.rm = TRUE</span></span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_age <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>f_age,</span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a>                     data.df<span class="sc">$</span>pid,</span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a>                     <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_age)</span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict</span></span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>f_age <span class="sc">&lt;=</span> <span class="dv">35</span>,]</span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a><span class="in">    * Use number of children to construct a binary indicator of wether the is a child in the household or not</span></span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>child_hh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>child <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-150"><a href="#cb41-150" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>child, data.df<span class="sc">$</span>child_hh)</span>
<span id="cb41-151"><a href="#cb41-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a><span class="in">    * Make sure we start only with men who are not yet fathers.</span></span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Child status at first wave</span></span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_child_hh <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>pynr <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>child_hh, <span class="cn">NA</span>)</span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_child_hh) <span class="co"># More than 1,500 individuals are already child_hh from the start on</span></span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute across individual, using mean and na.rm = TRUE</span></span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>f_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>f_child_hh,</span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a>                         data.df<span class="sc">$</span>pid,</span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>f_child_hh)</span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop those who are child_hh from the start</span></span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>f_child_hh <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a>__Note: this feels like dropping a lot of information! However, it makes sense if we want to correctly identify the effect of interest.__</span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a><span class="in">    * Do we need to drop observations where people go from child to no child?</span></span>
<span id="cb41-176"><a href="#cb41-176" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb41-179"><a href="#cb41-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-180"><a href="#cb41-180" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Change in child status within an id</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>fd_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a>                          data.df<span class="sc">$</span>pid,</span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span>(x) x <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(x, <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>)) <span class="co"># 0 instead of NA for 1st year</span></span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>fd_child_hh)</span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-189"><a href="#cb41-189" aria-hidden="true" tabindex="-1"></a><span class="co"># There are indeed people going from child to "no child"</span></span>
<span id="cb41-190"><a href="#cb41-190" aria-hidden="true" tabindex="-1"></a><span class="co"># It might be that children leave the households, or parents get divorced?</span></span>
<span id="cb41-191"><a href="#cb41-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-192"><a href="#cb41-192" aria-hidden="true" tabindex="-1"></a><span class="co"># One should usually look into this more carefully, but here let's just drop those observations.</span></span>
<span id="cb41-193"><a href="#cb41-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-194"><a href="#cb41-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-195"><a href="#cb41-195" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark observations starting with a negative fd value (jump from marry=1 to marry =0)</span></span>
<span id="cb41-196"><a href="#cb41-196" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>notstag_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(<span class="fu">ifelse</span>(data.df<span class="sc">$</span>fd_child_hh <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb41-197"><a href="#cb41-197" aria-hidden="true" tabindex="-1"></a>                               data.df<span class="sc">$</span>pid,</span>
<span id="cb41-198"><a href="#cb41-198" aria-hidden="true" tabindex="-1"></a>                               <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">cumsum</span>(x))</span>
<span id="cb41-199"><a href="#cb41-199" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>notstag_child_hh)</span>
<span id="cb41-200"><a href="#cb41-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-201"><a href="#cb41-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop after "loosing a child"</span></span>
<span id="cb41-202"><a href="#cb41-202" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[data.df<span class="sc">$</span>notstag_child_hh <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb41-203"><a href="#cb41-203" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data.df<span class="sc">$</span>fd_child_hh)</span>
<span id="cb41-204"><a href="#cb41-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span>    </span>
<span id="cb41-205"><a href="#cb41-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-206"><a href="#cb41-206" aria-hidden="true" tabindex="-1"></a><span class="in">    * Calculate the effect of having a child on th wage of men (including controls if reasonable). </span></span>
<span id="cb41-207"><a href="#cb41-207" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb41-208"><a href="#cb41-208" aria-hidden="true" tabindex="-1"></a><span class="in">    * Calculate effects for POLS, RE, and FE (if you have some extra time, also FEIS). (#Hint: feis needs a class `data.frame` as input data)</span></span>
<span id="cb41-209"><a href="#cb41-209" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb41-212"><a href="#cb41-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-213"><a href="#cb41-213" aria-hidden="true" tabindex="-1"></a><span class="co"># Age intervals</span></span>
<span id="cb41-214"><a href="#cb41-214" aria-hidden="true" tabindex="-1"></a>int <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>, <span class="fu">max</span>(data.df<span class="sc">$</span>age), <span class="dv">5</span>)</span>
<span id="cb41-215"><a href="#cb41-215" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>age_gr <span class="ot">&lt;-</span> <span class="fu">cut</span>(data.df<span class="sc">$</span>age, int, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-216"><a href="#cb41-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-217"><a href="#cb41-217" aria-hidden="true" tabindex="-1"></a><span class="co"># Formula with controls</span></span>
<span id="cb41-218"><a href="#cb41-218" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(logwages <span class="sc">~</span> child_hh <span class="sc">+</span> </span>
<span id="cb41-219"><a href="#cb41-219" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb41-220"><a href="#cb41-220" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb41-221"><a href="#cb41-221" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb41-222"><a href="#cb41-222" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6)</span>
<span id="cb41-223"><a href="#cb41-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-224"><a href="#cb41-224" aria-hidden="true" tabindex="-1"></a><span class="do">### POLS</span></span>
<span id="cb41-225"><a href="#cb41-225" aria-hidden="true" tabindex="-1"></a>mod.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(fm, <span class="at">data =</span> data.df)</span>
<span id="cb41-226"><a href="#cb41-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-227"><a href="#cb41-227" aria-hidden="true" tabindex="-1"></a><span class="do">### RE</span></span>
<span id="cb41-228"><a href="#cb41-228" aria-hidden="true" tabindex="-1"></a>mod.re <span class="ot">&lt;-</span> <span class="fu">plm</span>(fm, <span class="at">data =</span> data.df,</span>
<span id="cb41-229"><a href="#cb41-229" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb41-230"><a href="#cb41-230" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"random"</span>)</span>
<span id="cb41-231"><a href="#cb41-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-232"><a href="#cb41-232" aria-hidden="true" tabindex="-1"></a><span class="do">### FE</span></span>
<span id="cb41-233"><a href="#cb41-233" aria-hidden="true" tabindex="-1"></a>mod.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(fm, <span class="at">data =</span> data.df,</span>
<span id="cb41-234"><a href="#cb41-234" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb41-235"><a href="#cb41-235" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb41-236"><a href="#cb41-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-237"><a href="#cb41-237" aria-hidden="true" tabindex="-1"></a><span class="do">### FEIS</span></span>
<span id="cb41-238"><a href="#cb41-238" aria-hidden="true" tabindex="-1"></a><span class="co"># GIven that we have a relatively large T, we can actually use the 5 tenure dummies here</span></span>
<span id="cb41-239"><a href="#cb41-239" aria-hidden="true" tabindex="-1"></a>mod.feis <span class="ot">&lt;-</span> <span class="fu">feis</span>(logwages <span class="sc">~</span> child_hh <span class="sc">+</span> </span>
<span id="cb41-240"><a href="#cb41-240" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb41-241"><a href="#cb41-241" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb41-242"><a href="#cb41-242" aria-hidden="true" tabindex="-1"></a>                   smsa <span class="sc">+</span> </span>
<span id="cb41-243"><a href="#cb41-243" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.factor</span>(year) <span class="sc">|</span> ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, <span class="co"># Note we add year manually here</span></span>
<span id="cb41-244"><a href="#cb41-244" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">data.frame</span>(data.df),</span>
<span id="cb41-245"><a href="#cb41-245" aria-hidden="true" tabindex="-1"></a>                <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"pid"</span>), <span class="at">robust =</span> <span class="cn">TRUE</span>) <span class="co"># we use the cluster-robust SEs right away</span></span>
<span id="cb41-246"><a href="#cb41-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-247"><a href="#cb41-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-248"><a href="#cb41-248" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-249"><a href="#cb41-249" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb41-250"><a href="#cb41-250" aria-hidden="true" tabindex="-1"></a><span class="in">    * Compare using cluster robust standard errors (and screenreg).</span></span>
<span id="cb41-251"><a href="#cb41-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-254"><a href="#cb41-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-255"><a href="#cb41-255" aria-hidden="true" tabindex="-1"></a><span class="do">### Cluster robust SEs for RE and FE</span></span>
<span id="cb41-256"><a href="#cb41-256" aria-hidden="true" tabindex="-1"></a>vcov.re <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(mod.re, <span class="at">cluster =</span> <span class="st">"group"</span>, <span class="at">method =</span> <span class="st">"arellano"</span>, <span class="at">type =</span> <span class="st">"HC3"</span>)</span>
<span id="cb41-257"><a href="#cb41-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-258"><a href="#cb41-258" aria-hidden="true" tabindex="-1"></a>vcov.fe <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(mod.fe, <span class="at">cluster =</span> <span class="st">"group"</span>, <span class="at">method =</span> <span class="st">"arellano"</span>, <span class="at">type =</span> <span class="st">"HC3"</span>)</span>
<span id="cb41-259"><a href="#cb41-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-260"><a href="#cb41-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Plug into model object</span></span>
<span id="cb41-261"><a href="#cb41-261" aria-hidden="true" tabindex="-1"></a>mod.re<span class="sc">$</span>vcov <span class="ot">&lt;-</span> vcov.re</span>
<span id="cb41-262"><a href="#cb41-262" aria-hidden="true" tabindex="-1"></a>mod.fe<span class="sc">$</span>vcov <span class="ot">&lt;-</span> vcov.fe</span>
<span id="cb41-263"><a href="#cb41-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-264"><a href="#cb41-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-265"><a href="#cb41-265" aria-hidden="true" tabindex="-1"></a><span class="do">### Compare</span></span>
<span id="cb41-266"><a href="#cb41-266" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(<span class="fu">list</span>(mod.lm, mod.re, mod.fe, mod.feis), <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb41-267"><a href="#cb41-267" aria-hidden="true" tabindex="-1"></a>          <span class="at">custom.model.names =</span> <span class="fu">c</span>(<span class="st">"POLS"</span>, <span class="st">"RE"</span>, <span class="st">"FE"</span>, <span class="st">"FEIS"</span>), </span>
<span id="cb41-268"><a href="#cb41-268" aria-hidden="true" tabindex="-1"></a>          <span class="at">include.groups =</span> <span class="cn">FALSE</span>, <span class="co"># don't know why include.groups = FALSE is necessary here</span></span>
<span id="cb41-269"><a href="#cb41-269" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.coef =</span> <span class="st">"year"</span>) </span>
<span id="cb41-270"><a href="#cb41-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-271"><a href="#cb41-271" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-272"><a href="#cb41-272" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Interpret the results </span>
<span id="cb41-273"><a href="#cb41-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-274"><a href="#cb41-274" aria-hidden="true" tabindex="-1"></a>We can interpret the results above as follows:</span>
<span id="cb41-275"><a href="#cb41-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-276"><a href="#cb41-276" aria-hidden="true" tabindex="-1"></a>POLS and RE: Observations with at least one child in the household tend to have higher annual wages</span>
<span id="cb41-277"><a href="#cb41-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-278"><a href="#cb41-278" aria-hidden="true" tabindex="-1"></a>FE: If men become fathers, this increases their annual wage by ~ 4%. The effect is significant (would be highly significant without cluster robust SEs).</span>
<span id="cb41-279"><a href="#cb41-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-280"><a href="#cb41-280" aria-hidden="true" tabindex="-1"></a>FEIS: Given the heterogeneous wage trajectories, if men become fathers, this increases their annual wage by ~ 5%. </span>
<span id="cb41-281"><a href="#cb41-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-282"><a href="#cb41-282" aria-hidden="true" tabindex="-1"></a>In this case, FEIS estimates a higher premium than FE. This could indicate that those with steeper wage trajectories actually are less likely to get children or get their children later.</span>
<span id="cb41-283"><a href="#cb41-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-284"><a href="#cb41-284" aria-hidden="true" tabindex="-1"></a>Do you know why FEIS has a lower $N$ than the other models?</span>
<span id="cb41-285"><a href="#cb41-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-286"><a href="#cb41-286" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-287"><a href="#cb41-287" aria-hidden="true" tabindex="-1"></a><span class="ss">   * </span>Try to perform a placebo test: what happens if you use the "lead" of becoming father. Why is this an interesting test?</span>
<span id="cb41-288"><a href="#cb41-288" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-291"><a href="#cb41-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-292"><a href="#cb41-292" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> data.df[<span class="fu">order</span>(data.df<span class="sc">$</span>pid, data.df<span class="sc">$</span>year), ]</span>
<span id="cb41-293"><a href="#cb41-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-294"><a href="#cb41-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag </span></span>
<span id="cb41-295"><a href="#cb41-295" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>lag_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb41-296"><a href="#cb41-296" aria-hidden="true" tabindex="-1"></a>                            data.df<span class="sc">$</span>pid,</span>
<span id="cb41-297"><a href="#cb41-297" aria-hidden="true" tabindex="-1"></a>                            <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">lag</span>(x, <span class="dv">2</span>)) <span class="co"># lets use two years</span></span>
<span id="cb41-298"><a href="#cb41-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-299"><a href="#cb41-299" aria-hidden="true" tabindex="-1"></a><span class="co"># Lead</span></span>
<span id="cb41-300"><a href="#cb41-300" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>lead_child_hh <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb41-301"><a href="#cb41-301" aria-hidden="true" tabindex="-1"></a>                             data.df<span class="sc">$</span>pid,</span>
<span id="cb41-302"><a href="#cb41-302" aria-hidden="true" tabindex="-1"></a>                             <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">lead</span>(x, <span class="dv">2</span>)) <span class="co"># lets use two years</span></span>
<span id="cb41-303"><a href="#cb41-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-304"><a href="#cb41-304" aria-hidden="true" tabindex="-1"></a><span class="do">### Estimate FE models</span></span>
<span id="cb41-305"><a href="#cb41-305" aria-hidden="true" tabindex="-1"></a>lag.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> lag_child_hh <span class="sc">+</span> </span>
<span id="cb41-306"><a href="#cb41-306" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb41-307"><a href="#cb41-307" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb41-308"><a href="#cb41-308" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb41-309"><a href="#cb41-309" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, </span>
<span id="cb41-310"><a href="#cb41-310" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> data.df,</span>
<span id="cb41-311"><a href="#cb41-311" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb41-312"><a href="#cb41-312" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb41-313"><a href="#cb41-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-314"><a href="#cb41-314" aria-hidden="true" tabindex="-1"></a>lead.fe <span class="ot">&lt;-</span> <span class="fu">plm</span>(logwages <span class="sc">~</span> lead_child_hh <span class="sc">+</span> </span>
<span id="cb41-315"><a href="#cb41-315" aria-hidden="true" tabindex="-1"></a>                   hours <span class="sc">+</span> age_gr <span class="sc">+</span></span>
<span id="cb41-316"><a href="#cb41-316" aria-hidden="true" tabindex="-1"></a>                   profes <span class="sc">+</span> admin  <span class="sc">+</span> sales <span class="sc">+</span> crafts <span class="sc">+</span> operat <span class="sc">+</span> servic  <span class="sc">+</span> </span>
<span id="cb41-317"><a href="#cb41-317" aria-hidden="true" tabindex="-1"></a>                   smsa   <span class="sc">+</span></span>
<span id="cb41-318"><a href="#cb41-318" aria-hidden="true" tabindex="-1"></a>                   ten1 <span class="sc">+</span> ten2 <span class="sc">+</span> ten3 <span class="sc">+</span> ten4 <span class="sc">+</span> ten5 <span class="sc">+</span> ten6, </span>
<span id="cb41-319"><a href="#cb41-319" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> data.df,</span>
<span id="cb41-320"><a href="#cb41-320" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>),</span>
<span id="cb41-321"><a href="#cb41-321" aria-hidden="true" tabindex="-1"></a>              <span class="at">effect =</span> <span class="st">"twoways"</span>, <span class="at">model =</span> <span class="st">"within"</span>)</span>
<span id="cb41-322"><a href="#cb41-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-323"><a href="#cb41-323" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare</span></span>
<span id="cb41-324"><a href="#cb41-324" aria-hidden="true" tabindex="-1"></a><span class="fu">screenreg</span>(<span class="fu">list</span>(lag.fe, lead.fe), <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb41-325"><a href="#cb41-325" aria-hidden="true" tabindex="-1"></a>          <span class="at">custom.coef.map =</span> <span class="fu">list</span>(<span class="at">lag_child_hh =</span> <span class="st">"Lag Child"</span>, </span>
<span id="cb41-326"><a href="#cb41-326" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lead_child_hh =</span> <span class="st">"Lead Child"</span>))</span>
<span id="cb41-327"><a href="#cb41-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-328"><a href="#cb41-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-329"><a href="#cb41-329" aria-hidden="true" tabindex="-1"></a>Interestingly we already see a significant and non-trivial fatherhood effect on the wage two years before the future father actually become fathers.</span>
<span id="cb41-330"><a href="#cb41-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-331"><a href="#cb41-331" aria-hidden="true" tabindex="-1"></a>If we observe a treatment effect for a treatment that has not yet happened, this might indicate either 1) anticipation effects, or 2) that something is actually confounding our treatment (e.g. selection on pre-treatment trends)</span>
<span id="cb41-332"><a href="#cb41-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-333"><a href="#cb41-333" aria-hidden="true" tabindex="-1"></a>What do you think, what might be happening here?</span>
<span id="cb41-334"><a href="#cb41-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-335"><a href="#cb41-335" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exercise 3</span></span>
<span id="cb41-336"><a href="#cb41-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-337"><a href="#cb41-337" aria-hidden="true" tabindex="-1"></a>Can we use one of the new event-study approaches, such as the Callaway and SantAnna estimator?</span>
<span id="cb41-338"><a href="#cb41-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-339"><a href="#cb41-339" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Preprocess data (treatment group and timing indicator)</span>
<span id="cb41-340"><a href="#cb41-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-343"><a href="#cb41-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-344"><a href="#cb41-344" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment timing = year if child in household</span></span>
<span id="cb41-345"><a href="#cb41-345" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>child_hh <span class="sc">==</span> <span class="dv">1</span>, data.df<span class="sc">$</span>year, <span class="cn">NA</span>)</span>
<span id="cb41-346"><a href="#cb41-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-347"><a href="#cb41-347" aria-hidden="true" tabindex="-1"></a><span class="co"># Define those who never have a child</span></span>
<span id="cb41-348"><a href="#cb41-348" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>tmp <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>child_hh,</span>
<span id="cb41-349"><a href="#cb41-349" aria-hidden="true" tabindex="-1"></a>                   data.df<span class="sc">$</span>pid,</span>
<span id="cb41-350"><a href="#cb41-350" aria-hidden="true" tabindex="-1"></a>                   <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb41-351"><a href="#cb41-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-352"><a href="#cb41-352" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>never_child <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data.df<span class="sc">$</span>tmp <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb41-353"><a href="#cb41-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-354"><a href="#cb41-354" aria-hidden="true" tabindex="-1"></a><span class="co"># set never treated to zero</span></span>
<span id="cb41-355"><a href="#cb41-355" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing[data.df<span class="sc">$</span>never_child <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb41-356"><a href="#cb41-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-357"><a href="#cb41-357" aria-hidden="true" tabindex="-1"></a><span class="co"># if married is not NA, used min year per id (removing NAs)</span></span>
<span id="cb41-358"><a href="#cb41-358" aria-hidden="true" tabindex="-1"></a>oo <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(data.df<span class="sc">$</span>child_hh))</span>
<span id="cb41-359"><a href="#cb41-359" aria-hidden="true" tabindex="-1"></a>data.df<span class="sc">$</span>treat_timing[oo] <span class="ot">&lt;-</span> <span class="fu">ave</span>(data.df<span class="sc">$</span>treat_timing[oo],</span>
<span id="cb41-360"><a href="#cb41-360" aria-hidden="true" tabindex="-1"></a>                                data.df<span class="sc">$</span>pid[oo],</span>
<span id="cb41-361"><a href="#cb41-361" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb41-362"><a href="#cb41-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-363"><a href="#cb41-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-364"><a href="#cb41-364" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data.df[, <span class="fu">c</span>(<span class="st">"pid"</span>, <span class="st">"year"</span>, <span class="st">"child_hh"</span>, <span class="st">"never_child"</span>, <span class="st">"treat_timing"</span>)], <span class="at">n =</span> <span class="dv">35</span>)</span>
<span id="cb41-365"><a href="#cb41-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-366"><a href="#cb41-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-367"><a href="#cb41-367" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Estimate the model using <span class="in">`att_gt`</span></span>
<span id="cb41-368"><a href="#cb41-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-369"><a href="#cb41-369" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb41-370"><a href="#cb41-370" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate group-time average treatment effects using att_gt method</span></span>
<span id="cb41-371"><a href="#cb41-371" aria-hidden="true" tabindex="-1"></a>wages.attgt <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"logwages"</span>,</span>
<span id="cb41-372"><a href="#cb41-372" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb41-373"><a href="#cb41-373" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idname =</span> <span class="st">"pid"</span>,</span>
<span id="cb41-374"><a href="#cb41-374" aria-hidden="true" tabindex="-1"></a>                      <span class="at">gname =</span> <span class="st">"treat_timing"</span>,</span>
<span id="cb41-375"><a href="#cb41-375" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xformla =</span> <span class="sc">~</span> hours <span class="sc">+</span> age_gr,</span>
<span id="cb41-376"><a href="#cb41-376" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> data.df,</span>
<span id="cb41-377"><a href="#cb41-377" aria-hidden="true" tabindex="-1"></a>                      <span class="at">allow_unbalanced_panel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-378"><a href="#cb41-378" aria-hidden="true" tabindex="-1"></a>                      <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb41-379"><a href="#cb41-379" aria-hidden="true" tabindex="-1"></a>                      <span class="at">est_method =</span> <span class="st">"ipw"</span></span>
<span id="cb41-380"><a href="#cb41-380" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb41-381"><a href="#cb41-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-382"><a href="#cb41-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-383"><a href="#cb41-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-384"><a href="#cb41-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-387"><a href="#cb41-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-388"><a href="#cb41-388" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the group-time specific estimates</span></span>
<span id="cb41-389"><a href="#cb41-389" aria-hidden="true" tabindex="-1"></a>wages.dyn <span class="ot">&lt;-</span> <span class="fu">aggte</span>(wages.attgt, <span class="at">type =</span> <span class="st">"dynamic"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-390"><a href="#cb41-390" aria-hidden="true" tabindex="-1"></a>                   <span class="at">min_e =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">max_e =</span> <span class="dv">6</span>)</span>
<span id="cb41-391"><a href="#cb41-391" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wages.dyn)</span>
<span id="cb41-392"><a href="#cb41-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-393"><a href="#cb41-393" aria-hidden="true" tabindex="-1"></a>zp3 <span class="ot">&lt;-</span> <span class="fu">ggdid</span>(wages.dyn) </span>
<span id="cb41-394"><a href="#cb41-394" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-395"><a href="#cb41-395" aria-hidden="true" tabindex="-1"></a>zp3 <span class="ot">&lt;-</span> zp3 <span class="sc">+</span> </span>
<span id="cb41-396"><a href="#cb41-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="fu">gray</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb41-397"><a href="#cb41-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb41-398"><a href="#cb41-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-399"><a href="#cb41-399" aria-hidden="true" tabindex="-1"></a>zp3</span>
<span id="cb41-400"><a href="#cb41-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-401"><a href="#cb41-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-402"><a href="#cb41-402" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Interpret the results </span>
<span id="cb41-403"><a href="#cb41-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-404"><a href="#cb41-404" aria-hidden="true" tabindex="-1"></a>The event-time results above again tell a little different story. First, hose getting father already have a little higher wage two and three years before they become fathers. Then, there is a negative anticipation effect in the year before birth (why could this be plausible?). After birth of the first child, fathers' wages increase significantly more then the wages of non-fathers (however, this is not much more than the effect in year -3).</span>
<span id="cb41-405"><a href="#cb41-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-406"><a href="#cb41-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-407"><a href="#cb41-407" aria-hidden="true" tabindex="-1"></a><span class="fu"># References</span></span>
<span id="cb41-408"><a href="#cb41-408" aria-hidden="true" tabindex="-1"></a>  </span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>